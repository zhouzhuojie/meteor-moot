/*

Moot v1.8.1 (beta) | Dec 3, 2013

"Forums and Commenting re-imagined"

https://moot.it | (c) 2013 Moot Inc

*/!function(e,t){"use strict";function o(e,o){var n={},a=[].slice;return e=e||{},t.extend(e,{on:function(o,a,i){if(o=o.split(" "),t.isFunction(a)&&(i=a,a=0),t.isFunction(i)){for(var r,s=0,l=o.length;l>s;s++)r=t.trim(o[s]),(n[r]=n[r]||[]).push(i),(l>1||"*"==o)&&(i.typed=!0);a&&(i.typed?i("inline",a):i(a))}return e},off:function(o,a){if("*"==o)return n={};o=o.split(" ");for(var i,r=0;o.length>r;r++)if(i=t.trim(o[r]),a){for(var s=n[i]||[],l=-1,c=0,d=s.length;d>c;c++)if(s[c]===a||s[c].listener===a){l=c;break}l>=0&&s.splice(l,1)}else n[i]=[];return e},one:function(o,n){function a(){e.off(o,n),n.apply(e,arguments)}return t.isFunction(n)&&(a.listener=n,e.on(o,a)),e},emit:function(t){var o=a.call(arguments,1),i=n[t]||[],r=n["*"];r&&(i=i.concat(r));for(var s,l,c=0,d=i.length;d>c;++c)if(s=i[c],s&&(l=s.typed?[t].concat(o):o,s.apply(e,l)===!1))return e;return e}}),t.each(o||[],function(o,n){e[n]=function(o){return t.isFunction(o)?e.on(n,o):e.emit.apply(e,[n].concat(a.call(arguments)))}}),e}function n(n){function a(e,o,n){var a=new FormData;e.params[0],e.transport="ajax",t.each(o,function(e,t){a.append(t.altname||t.name,t)}),a.append("jsonrpc",JSON.stringify(e));var r=new XMLHttpRequest;r.onload=function(e){i(JSON.parse(e.target.response))},r.onprogress=function(e){n.progress(e)},r.open("POST",m),r.send(a)}function i(e){if(!e)return l.emit("heartbeat");if("string"==typeof e&&(e=JSON.parse(e)),e.params&&"ping"==e.params[0])return l.emit("heartbeat");if(t.isArray(e))return t.each(e,function(e,t){i(t)});l.emit("receive",e),e.session&&(c=e.session,t.cookie2(k,c.sessionId)),n.pollUrl=n.pollUrl||e.pollUrl;var o=p[e.id];o?(o.always(e.result,e.error),void 0!==e.result&&o.done(e.result)):"emit"==e.method&&d.emit.apply(null,e.params),void 0!==e.error&&(o&&o.fail(e.error,e.data),l.error(e.error,e.data)),s||(e.result&&l.ready(e.result),s=!0)}if(t.isFunction(n))return _.push(n);var r,s,l=o(this,["ready","error","close","reconnect","destroy"]),c={sessionId:t.cookie2(k)},d=o({}),u=0,p={};"string"==typeof n&&(n={url:n}),l.conf=n=t.extend({transports:"upgrade,xdomain",pollUrl:null,secure:!0},n);var m=n.url;if(443==m.port&&(m.port=80),m="http"+(n.secure?"s":"")+"://"+m.hostname+(m.port&&80!=m.port?":"+m.port:""),t.each(n.transports.split(","),function(e,t){var o=x[t];!r&&o&&o.supported&&(r=new o(m,l,i),l.transport=t)}),!r)throw Error("json-rpc: no support for "+n.transports);l.event=function(e,t){return d.on(e,t),l},l.session=function(){return t.extend({},c)},l.reload=function(){return u=0,r.destroy(),r.ping(),l},l.poll=function(){var e=n.pollUrl;-1==e.indexOf("://")&&(e=m+e),r.poll&&r.poll(e,t.extend({},c,{transport:r.name}))},l.log=function(e,o){var n={message:e,data:t.extend(o,{url:location.href,ua:navigator.userAgent})};t.post(m,JSON.stringify({method:"log",jsonrpc:"2.1.0",params:[n],session:c}),t.noop,"json")},window.mootlog=l.log,l.call=function(n){if(l.is_closed||l.is_destroyed)throw Error("connection "+(l.is_closed?"closed":"destroyed"));var i,d=[].slice.call(arguments),m=d.slice(-1)[0],f={method:n,params:d.slice(1,-1)};if(t.isFunction(m)?(i=o({},["done","fail","always","progress"]).done(m),f.id="#"+ ++u,p[f.id]=i):(void 0!==m&&(f.params=d.slice(1)),m=void 0),f.params.length||delete f.params,f.session=c,s||(f.jsonrpc="2.1.0"),f.transport=l.transport,l.emit("send",n,f.params,i),!e&&window.File&&f.params){var g=f.params[0],h=g&&g.files;if(h)return delete g.files,a(f,h,i),i}return r.send(JSON.stringify(f)),i},t.each(_,function(){this.call(l,r)});var f=e;e||t(window).load(function(){f=!0}),l.destroy(function(){l.is_destroyed=!0,r.destroy()}).error(function(e){"error_invalid_channel"==e&&(t.cookie2(k,""),l.inited=!1,l.reconnect())}).close(function(){s=!1}).ready(function(){t.isFunction(r.poll)&&(e?l.poll():setTimeout(l.poll,f?1e3:3e3))})}function a(e,t,o){e/=o?S:2,e+=~~(e/t);for(var n=q-j,a=~~(n*A/2),i=0;e>a;i+=q)e=~~(e/n);var r=(q-j+1)*e,s=e+$;return i+~~(r/s)}function i(e,t){for(var o=1114112,n=0,a=e.length;a>n;++n){var i=e[n];i>=t&&o>i&&(o=i)}return o}function r(e){return e+(26>e?97:22)}function s(e,t){return t+j>=e?j:e>=t+A?A:e-t}function l(e,t){for(var o=[],n=q,a=t;;n+=q){var i=s(n,e);if(i>a){o.push(r(a));break}o.push(r(i+(a-i)%(q-i))),a=~~((a-i)/(q-i))}return o}function c(e){e=t.map(e.split(""),function(e){return e.charCodeAt(0)});for(var o=[],n=[],r=0,s=e.length;s>r;++r){var c=e[r];128>c?o.push(c):n.push(c)}var d,u;d=u=o.length,d&&o.push(45);for(var p=O,m=D,f=0,s=e.length;s>u;++p,++f){var g=i(n,p);f+=(g-p)*(u+1),p=g;for(var r=0;s>r;++r){var c=e[r];p>c?++f:c==p&&(o=o.concat(l(m,f)),m=a(f,u+1,d==u),f=0,u++)}}return String.fromCharCode.apply(String,o)}function d(e,o){return t.isFunction(e)&&e.apply(o,[].slice.call(arguments,2)),o}function u(e,t){e=e.replace("/moot.it/","/api.moot.it/").replace("/i/","/");var o=e.split("/");o[o.length-1]=o.slice(-1)[0].replace(":","#"),e=o.join("/");var n=e.split("#");n[1]&&(e=n[0]+"#"+p(n[1])),e=I(e),"/"==e.href.slice(-1)&&(e.href=e.href.slice(0,-1),e.pathname=e.pathname.slice(0,-1));var a=e.href,i=a.split("/"),r="//"==a.slice(0,2)||a.indexOf("://")>0?a.slice(8).indexOf("/")+8:a.indexOf("/");return e.path=a.slice(r),e.host=i[2],t&&!/moot.it/.test(e.host)&&(t=I(t),e.orighost=e.host,e.host=t.hostname+(t.port?":"+t.port:""),e.protocol=t.protocol,e.hostname=t.hostname,e.port=t.port),e}function p(e){e=t.trim(e.toLowerCase().slice(0,10*L)),e=e.replace(/&quest;/g,"");var o={a:/[áàâãªäå]/g,o:/[òóôõºöø]/g,e:/[éèê]/g,i:/[íìîı]/g,u:/[úùûü]/g,c:/[ç]/g,n:/[ñ]/g,"-":/[_\s]+/g};return t.each(o,function(t,o){e=e.replace(o,t)}),e=c(e).slice(0,10*L),e=e.replace(/[^a-z0-9-]/g,"").replace(/^-|-$/g,"").replace(/\-{2,}/g,"-"),e||(""+Math.random()).slice(10)}function m(e,o){if(void 0===e||"number"==typeof e)return F[1*e||0];if(t.isFunction(e)&&(o=e,e="ready"),"string"==typeof e)if(-1!=e.indexOf("/"))e={url:e};else if(t.isFunction(o))return(H[e]=H[e]||[]).push(o);if(t.isPlainObject(e)){e=t.extend({api:"https://api.moot.it"},e),"object"!=typeof console&&(e.debug=0);var n=new f(e);return t.isFunction(o)&&H.ready.unshift(o),t.each(H,function(e,o){t.each(o,function(){n.on(e,this)})}),n.emit("before:init",n),F.push(n),n}}function f(e){"string"==typeof e&&(e={url:e});var a,i=o(this),r=u(e.url,e.api),s=r.pathname.split("/");e.url=r,e.api=r.protocol+"//"+r.host,t.extend(i,{version:"1.8.1",channel:null,name:s[1],path:"/"+s[1],is_commenting:!!r.hash,is_forum:!r.hash&&3>s.length,is_threaded:!r.hash&&s.length>2,conf:function(){return e},load:function(t,o){if(i.is_stub)throw Error("Forum not created");i.is_threaded&&!t.split("#")[1]&&(t=e.url.path);var n=new b(i,t,a);i.emit("before:load",n),a.call("moots",{path:n.path},function(e){n.emit("load",e),i.one("load",o).emit("load",n)})},search:function(e,t){return i.load("/?"+e,t)},create:function(o,n){var r=m.fixTitle(o.title);if(!r)throw Error("Empty title");if(r.length>30*L)throw Error("Title too long");if(!i.user.is_logged)throw Error("Not logged");t.extend(o,{title:r,key:p(r),body:m.fixBody(o.body,!0),pageLocation:e.pageUrl,path:o.path||i.page.path,watch:!0}),i.is_threaded&&t.extend(o,{pageTitle:e.pageTitle,mootTitle:e.mootTitle});var s=new v(i,o.path+"#"+o.key,o,a,!0);return i.page.emit("before:moot",s),a.call("createMoot",o,function(e){s.emit("key",e),s.seed.emit("key",e),i.page.one("moot",n).emit("moot",s,!0),s.is_followed=!0,s.emit("follow")})},createForum:function(e,o){var n=e.categories;return"string"==typeof n[0]&&(n=t.grep(n,function(e){return!!e}),e.categories=n=t.map(n,function(e){return{title:e.slice(0,40),path:i.path+"/"+p(e)}})),a.call("createForum",e,function(){i.is_stub=!1,i.categories=n,i.emit("categories",n),d(o,i,n)})},getCategory:function(e){return e=e.split("#")[0],t.grep(i.categories,function(t){return t.path==e})[0]},setCategories:function(e,o){return t.each(e,function(e,t){t.path||(t.path=p(t.title)),-1==t.path.indexOf(i.path)&&(t.path=i.path+"/"+t.path)}),a.call("setCategories",{path:i.path,categories:e},function(){i.emit("categories",e),d(o,i,e)})},update:function(e,t){i.user.is_admin&&(e.forumname=i.name,a.call("forumUpdate",e,function(){i.one("update",t).emit("update",e)}))},reload:function(e){return i.channel.off("*"),i.off("before:load load error waiting destroy categories"),i.page=new b(i,i.page.path,a),t.isFunction(e)&&(i.one("load",e),e=null),e&&(e.moots||e.user)?i.emit("init",e):i.emit("before:init",i),i},log:function(e,o){o=t.extend({forum:i.path,page:i.page.path,user:i.user.email,version:i.version,url:location.href,ua:navigator.userAgent},o),a.call("log",{message:e,data:o})},destroy:function(){return a.destroy(),i.is_destroyed=!0,i.emit("destroy")}}).on("before:init",function(){a||(a=new n({url:r,transports:e.transports,secure:!(t.browser.msie&&"https"!=e.pageUrl.slice(0,5))}),i.channel=new g(i,a),a.reconnect(i.reload),i.page=new b(i,r.path,a),e.path&&(i.is_forum||i.is_threaded&&e.path.split("#")[1])&&(i.page=new b(i,e.path,a))),i.page.is_init=!0,e.pageUrl.split("file://")[1]&&(e.pageUrl="https://moot.it"+i.path);var o={version:i.version,path:i.page.path,currentForum:i.name,pageLocation:e.pageUrl};e.sso&&e.sso.key&&(o.api=e.sso),a.call("init",o,function(e){i.emit("init",e)}).fail(function(e){i.emit("error",e[0])})}).on("init",function(e){i.page.is_init=!0,t.extend(i,e),i.is_stub=!e.moots,i.user=new w(i,e.user,a),i.emit("ready",i,a),i.emit("before:load",i.page),i.page.emit("load",e.moots),i.emit("load",i.page),delete i.moots}).on("load",function(e){i.page=e}).on("categories",function(e){e&&(i.categories=e,i.is_stub=!1)})}function g(e,n){var a=o(this),i=e.conf().debug;n.event("moot",function(t,o){t.from_channel=o.from_channel=!0;var i=new v(e,t,o,n),r=!!e.getCategory(t.path),s=e.page;e.is_forum&&r&&a.emit("moot",i),"feed"!=s.type&&("all"!=s.type&&(i.page.path+"/").slice(0,s.path.length+1)==s.path+"/"||s.title==i.seed.user.displayname||"all"==s.type&&r)&&(e.is_forum||a.emit("moot",i),s.emit("moot",i,!0))}).event("reply",function(t,o){var i=e.page.find(t);if(!i){if(e.is_commenting)return!1;if(e.is_threaded){if(t.split("#")[0]!=e.page.path)return!1}else if(!e.getCategory(t))return!1;i=new v(e,t,{},n)}o.from_channel=!0,o=new y(i,o,n),i.emit("reply",o),a.emit("reply",o)}).event("type",function(t,o){(e.is_forum&&e.getCategory(t)||e.page.path==t)&&a.emit("type",o,t);var n=e.page.find(t);n&&n.emit("type",o)}).event("like unlike remove spam unspam update",function(t,o,n){var i=e.page.find(o);i&&i.seed&&(i=i.seed),i&&i.emit(t,n,!0),a.emit(t,i||o,n)}).event("error",function(e,t){i&&console.error(arguments),a.emit("error",e,t)}).event("enter leave away return login join",function(e,t,o){a.emit(e,t,o)}).event("banned message",function(t,o){e.user.emit(t,o)}).on("send",function(o,n,a){if(a){var i,r=+new Date;t.each([3e3,5e3,8e3,12e3],function(t,n){setTimeout(function(){!i&&+new Date-r>n&&(0==t&&e.emit("waiting",o,a),a.emit("progress",t,n))},n)}),a.done(function(){i=1}).fail(function(){i=1})}}).ready(function(){a.session=n.session()}).on("login close reconnect error",a.emit),i&&n.on("send",function(e,t){console.info(">",e,t&&1==t.length?t[0]:t)}).on("receive",function(e){e&&console.info("<",e.result||e.params||e)})}function h(e,o,n,a){var i=this,r=e.path,s=e.app.page,l=e.match_count>=0&&a;i.is_gap=!0,i.size=i.available=o,l&&(i.match_count=e.match_count,t.each(e.replies,function(){this.is_gap||i.match_count--})),i.more=function(a,l){if(!i.available)return d(l);var c=Math.min(i.available,Math.ceil(o/(10>o?1:27>o?2:4))),u=a?c:e.reply_count,p=a?1:c,m=a?0:e.replies.length-1;if(a)for(var f,g=0;e.replies.length>g&&(f=e.replies[g],f!=i);g++)u+=f.is_gap?f.available:1,p+=f.is_gap?f.available:1,m++;else{for(var f,g=m;g>=0&&(f=e.replies[g],f!=i);g--)u-=f.is_gap?f.available:1,m--;0>=m&&(m=1),p=u-p+1}var v={path:r,start:u,end:p,timeout:300};return i.match_count>0&&(v.path+="search"==s.type?"?"+s.title:"@"+s.username,delete v.end),n.call("moreReplies",v,function(o){o=t.map(o,function(t){var o=t.reply_count;return i.available-=o||1,!o&&i.match_count&&i.match_count--,o?new h(e,o,n):new y(e,t,n)}),0>i.available&&(i.available=0),e.one("more",l).emit("more",o,m)})}}function v(e,n,a,i,r){function s(){if(r)throw Error("Not saved");if(!e.user.is_logged)throw Error("not logged")}var l=o(this),c=e.page;if("string"==typeof n){var u=n.split("#");n={page:e.getCategory(u[0])||{path:n,title:n},path:n}}r&&(n.is_expanded=!0),t.extend(l,n),t.extend(l,{app:e,replies:[],reply_count:l.reply_count||0,time:l.time||+new Date,has_replied:!!n.has_replied,is_followed:!!n.is_watched,is_expanded:!!n.is_expanded}),l.page=l.page||{},l.page.path=n.path.split("#")[0],r||a.user||e.is_commenting||(l.is_commenting=!0,a.user={}),l.seed=a=new y(l,a,i,r),l.is_own=r||a.user&&a.user.path==e.user.path,t.extend(l,{is_loaded:l.is_expanded,reply:function(o,n){if(s(),!t.trim(o.body))throw Error("no content");var a=e.conf(),r=l.seed.is_stub;o.body=m.fixBody(o.body,!0),o.key=p(o.body.join("")),o.watch=!0;var d=new y(l,o,i,!0);return l.emit("before:reply",d),t.extend(o,{path:r?c.path:l.path,mootTitle:a.mootTitle||a.pageTitle,pageTitle:a.pageTitle,pageLocation:a.pageUrl}),i.call("reply",o,function(e){d.emit("key",e),l.one("reply",n).emit("reply",d),l.is_followed=!0,l.emit("follow")})},posts:function(){return t.grep([l.seed].concat(l.replies||[]),function(e){return!e.is_gap})},find:function(e){if(l.seed.key==e)return l.seed;e.split("#")[1]||(e=l.path+"/"+e);for(var t=0,o=l.posts(),n=o.length;n>t;t++)if(o[t].path==e)return o[t]},expand:function(e){return l.toggle(!0,e)},collapse:function(e){return l.toggle(!1,e)},load:function(t){var o=l.path+("search"==e.page.type?"?"+e.page.title:"user"==e.page.type?"@"+e.page.username:"");return l.is_loaded?d(t,l):i.call("moot",o,function(e){l.one("load",t).emit("load",e).emit("expand")})},toggle:function(o,n){function a(){return l.one(r,n).emit(r)}if(t.isFunction(o)&&(n=o,o=void 0),"boolean"!=typeof o&&(o=!l.is_expanded),o==l.is_expanded)return d(n,l);if(o&&!l.is_loaded)return l.load(n);var r=o?"expand":"collapse";return e.user.is_logged?i.call(r+"Moot",l.path,a):a()},followToggle:function(o,n){if(s(),t.isFunction(o)&&(n=o,o=void 0),"boolean"!=typeof o&&(o=!l.is_followed),o==l.is_followed)return d(n,l,o);var a=l.path;return o&&(a={pageLocation:e.conf().pageUrl,path:a}),i.call("moot"+(o?"Watch":"Unwatch"),a,function(){var e=o?"follow":"unfollow";l.is_followed=o,l.one(e,n).emit(e)})}}).on("key",function(e){r=!1,l.path=l.page.path+"#"+e}).on("load",function(e){l.is_loaded=l.is_expanded=!0,l.reply_count=e.reply_count,l.seed=new y(l,e.seed,i)}).on("load",n,function(e){var o=0;l.match_count=e.match_count,t.each(e.replies||[],function(e,t){var n=t.reply_count;l.replies.push(n?new h(l,n,i):new y(l,t,i)),o+=n||1}),l.is_expanded&&l.reply_count>o&&l.replies.unshift(new h(l,l.reply_count-o,i,!0))}).on("reply",function(e){l.lastReply=+new Date,l.reply_count++,e.is_own&&(l.has_replied=!0),l.is_loaded&&l.replies.push(e)}).on("remove",function(e){return e.is_seed?c.emit("remove",l):(l.replies=t.grep(l.replies,function(t){return t.path!=e.path}),l.reply_count--,void 0)}).on("more",function(e,t){[].splice.apply(l.replies,[t,0].concat(e))}).on("expand collapse",function(e){l.is_expanded="e"==e[0]})}function b(e,n,a){var i=o(this);e.path&&n.slice(0,e.path.length)!=e.path&&(n=e.path+"/"+n),n=n.replace("//","/").replace(/[<>]/g,""),"/"==n.slice(-1)&&(n=n.slice(0,-1));var r=n.split("::");n=r[0],i.type=/\?/.test(n)?"search":/\/feed/.test(n)?"feed":n==e.path+"/spam"?"spam":/@/.test(n)?"user":2==n.split("/").length?"all":/#/.test(n)?"moot":"page","user"==i.type&&(i.username=n.split("@")[1]),t.extend(i,{app:e,path:n,extra:r[1],find:function(e){for(var t,o=0;i.length>o;o++){if(t=i[o],t.path==e)return t;if(t=t.find(e))return t}},more:function(e){return i.available?(i.emit("before:more"),a.call("moots",{path:i.path,start:i.length},function(t){i.one("more",e).emit("more",t)})):void 0},lift:function(t,o){var n=i.find(t);n&&e.page.emit("remove",n),a.call("moot",t,function(t){var n=new v(e,t,t.seed,a);i.one("moot",o).emit("moot",n,!0)})},reply:function(e,o){var a=i.find(e.path);return a?a.is_expanded?a.reply(e,o):a.expand(function(){a.reply(e,o)}):i.lift(n,function(n){setTimeout(function(){n.reply(e,o)},t.browser.msie?1e3:0)}),a},like:function(e){var t=i.find(e);return t?(t.seed&&(t=t.seed),t.like()):a.call("like",e),t},collapse:function(e){var o=t.grep(i,function(e){return e.is_expanded}),n=t.map(o,function(e){return e.path});return a.call("collapseMoot",n,function(){t.each(o,function(){this.emit("collapse",!0)}),d(e,i,o)})}}).on("load",function(o){if(e.is_stub)return!1;if(t.extend(i,o),!i.title){var a=t.trim(n.replace(/[\/-]/g," "));a=a[0].toUpperCase()+a.slice(1),i.title=a}i.available=o.size,delete i.entries,e.is_commenting&&(o.entries[0]||o.entries.push({seed:{user:e.user},is_expanded:!0,path:n}),o.entries[0].seed.is_stub=!0)}).on("load more",function(o,n){t.each(n.entries,function(t,o){var n=new v(e,o,o.seed,a);i.emit("moot",n)}),i.available-=n.entries.length}).on("moot",function(e,t){i[t?"unshift":"push"](e)}).on("remove",function(e){var o;t.each(i,function(t,n){return n.path!=e.path?(o=t,!1):void 0}),o&&(i.splice(o,1),i.size--)})}function y(e,n,a,i){function r(){if(!c.is_logged)throw Error("not logged");if(i)throw Error("not saved")}var s=o(this),l=e.app,c=l.user,u=e.path+(n.title||n.is_stub?"":"/"+n.key);i&&(n=t.extend({},n,{user:c})),n.body=n.body||[],n.user=n.user||{},l.users&&l.users.isAdmin(n.user)&&(n.user.is_admin=!0),t.extend(s,n,{app:l,moot:e,path:u,key:n.key||u.split("#")[1],is_own:i||n.user.path==c.path,likes:0,is_expanded:!!n.body[1],is_loaded:!n.has_more||!!n.body[1],is_seed:!!n.title,is_new:!!n.from_channel||c.new_count.all>0&&n.is_new,is_liked:!!n.is_liked,like_count:n.like_count||0,meta:n.meta||{},time:n.time||+new Date,likeToggle:function(o,n){if(r(),t.isFunction(o)&&(n=o,o=void 0),void 0===o&&(o=!s.is_liked),o==s.is_liked)return d(n,s,c);var i=s.is_liked?"unlike":"like",p=l.conf(),m=u;return e.seed.is_stub&&o&&(m={pageLocation:p.pageUrl,mootTitle:p.mootTitle||p.pageTitle,pageTitle:p.pageTitle,path:u}),a.call(i,m,function(){s.one(i,n).emit(i,c),e.emit(i,s)})},like:function(e){return s.likeToggle(!0,e)},unlike:function(e){return s.likeToggle(!1,e)},setMeta:function(e,t){return r()&&a.call("setMeta",u,e,function(){s.one("meta",t).emit("meta",e)})},remove:function(e){if(!s.removable())throw Error("No permission");var t=c.is_admin?{path:u,force:1}:u;return a.call("delete",t,function(){s.one("remove",e).emit("remove")})},removable:function(){return c.is_admin||i||s.is_own&&!s.like_count&&(!e.replies.length||e.replies.slice(-1)[0]==s)&&2.718*60>(+new Date-s.time)/1e3},whoLikes:function(e){return s.likes?e.call(s,s.likes):a.call("whoLikes",u,function(t){s.likes=t||[],d(e,s,t)})},more:function(e){return s.is_loaded?d(e,s):a.call("more",u,function(t){s.one("more",e).emit("more",t)})},toggle:function(e,o){function n(){return s.one(i,o).emit(i)}if(t.isFunction(e)&&(o=e,e=void 0),void 0===e&&(e=!s.is_expanded),e===s.is_expanded)return d(o,s);if(e&&!s.is_loaded)return s.more(o);var i=e?"expand":"collapse";return c.is_logged?a.call(i+"Post",u,n):n()},expand:function(e){return s.toggle(!0,e)},collapse:function(e){return s.toggle(!1,e)}}).on("key",function(t){s.key=t,s.path=u=s.is_seed?e.path:e.path+"/"+t,i=!1}).on("like",function(e){(e.is_logged||e.path==c.path)&&(s.is_liked=!0),s.likes&&s.likes.push(e),s.like_count++}).on("unlike",function(e){(e.is_logged||e.path==c.path)&&(s.is_liked=!1),s.likes&&(s.likes=t.grep(s.likes,function(e){return e.path!=c.path})),s.like_count--}).on("more",function(e){s.is_loaded=s.is_expanded=!0,s.body.push(e)}).on("expand collapse",function(e){s.is_expanded="expand"==e}).on("remove",function(t,o){e.emit("remove",s,o)}).on("meta",function(e){t.extend(s.meta,e)}).on("update",function(e){t.extend(s,e)}).on("spam unspam",s.spam_level,function(e,t){if(s.spam_level=t,"inline"!=e&&(s.flag=e),-1==t)s.emit("remove");else if(t>=1){var o=20*L;s.body[0]=s.body[0].replace(/\n/g," "),s.body[0].length>o&&(s.body[1]=s.body[0].slice(o)+(s.body[1]||""),s.body[0]=s.body[0].slice(0,o)),s.is_expanded=!1}}),t.each(["spam","unspam"],function(e,t){s[t]=function(e){return r(),a.call(t,u,function(o){s.one(t,e).emit(t,o)})}})}function w(e,n,a){function i(){if(!s.is_logged)throw Error("must be logged")}function r(e){return e[0].toUpperCase()+e.slice(1)}var s=o(this),l=(e.path+"/feed",0);n.new_count=n.new_count||{all:0,feed:0},e.is_stub&&n.path&&(n.is_admin=!0),n.img=n.img||"//cloudinary-a.akamaihd.net/moot/image/upload/t_default-avatar/v1364433583/moot-default-avatar.jpg",n.email||delete n.email,t.extend(s,n,{app:e,is_logged:!!n.path,is_visible:!!n.is_visible,logout:function(t){return i(),a.call("logout",e.page.path,function(o){e.reload(o),d(t,s)})},join:function(t,o){if(s.is_logged)throw Error("already logged");return t.username=t.username.toLowerCase(),a.call("join",t,function(t){e.reload(t),d(o,s)})},update:function(t,o){return t.forumname=e.name,a.call("userUpdate",t,function(){t.url||s.emit("update",t),d(o,s)})},isAvailable:function(e,t){return a.call("isAvailable",e,t)},unfollowAll:function(){return a.call("forumUnwatch",e.path,function(){t.each(e.page,function(){this.is_followed=!1,this.emit("unfollow")})})},type:function(t,o,n){if(!s.is_logged||s.is_visible){var i=+new Date;i-l>1e3*L&&(a.call("type",{path:o?o.path:e.page.path,size:t.length},n),l=i)}},hideToggle:function(t){return a.call("user"+(s.is_visible?"Hide":"Show"),function(){var o=s.is_visible=!s.is_visible;e.channel.emit(o?"enter":"leave",s,e.users.anon_count),d(t,s,o)})}}),t.each(["email_confirm","account_confirm","password_reset","validationCode_send","resetCode_check"],function(t,o){var n=o.split("_");s[n[1]+r(n[0])]=function(t,o){return a.call(n[0]+r(n[1]),t,function(t){t&&t.moots&&e.reload(t),d(o,s,t)})}}),s.on("update",function(e){delete e.email,t.extend(s,e),s.is_logged=!0}).on("follow unfollow",function(e){s.subscription_count+="follow"==e?1:-1}),e.on("load",function(e){s.emit("newcount",s.new_count),s.new_count[e.type]=0,"all"==e.type&&(s.new_count.feed=0)}),e.channel.on("moot reply",function(t,o){e.page.find(o.path)||(s.new_count.all++,s.emit("newcount",s.new_count))})}!function(e){if(!e.browser){var t=e.browser={},o=navigator.userAgent.toLowerCase(),n=/(chrome)[ \/]([\w.]+)/.exec(o)||/(webkit)[ \/]([\w.]+)/.exec(o)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(o)||/(msie) ([\w.]+)/.exec(o)||0>o.indexOf("compatible")&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(o)||[];n[1]&&(t[n[1]]=!0,t.version=n[2]||"0")}}(jQuery);var k="jsonrpc.session",x={},_=[];e||(window.RPC=n),x.ajax=function(e,o,n){var a=this,i={};t.extend(a,{send:function(o){o=o.replace(/\?\?/g,"?&quest;"),t.post(e,o,n,"json")},poll:function(e,r){a.destroy(),i=t.post(e,r,0,"json").done(function(t){n(t),t.error||a.poll(e,r)}).fail(function(e,t){o.is_destroyed||"abort"==t||o.close()})},destroy:function(){1==i.readyState&&i.abort()},ping:function(o){return t.ajax({url:e+"/ping",dataType:"text"}).done(o)}})},x.ajax.supported=t.support.cors,t.cookie2=function(e,t,o){var n=window.localStorage,a=null===t,i=void 0===t;if(void 0===o&&(o=999),"file:"==location.protocol){if(n)return a?n.removeItem(e):i?n[e]:n[e]=t;throw"moot: localStorage support needed under file:// protocol"}if(a&&(o=-1),i){var r,s,l=document.cookie;if(l&&(r=l.indexOf(e+"="),r>-1))return s=l.indexOf(";",r),l.slice(r+e.length+1,s>-1?s:l.length)}else document.cookie=e+"="+escape(t)+"; path=/"+(o?";expires="+new Date(+new Date+864e5*o).toUTCString():"")},x.upgrade=function(e,o,n){var a,i=this,r=new x.ajax(e,o,n),s=x.websocket.supported;s&&(s=new x.websocket(e,o,n),o.one("receive",function(e){e.result&&s.ping(function(){if(!e.session||!e.session.sessionId)throw Error("Empty sessionId");s.send(JSON.stringify({method:"rpc.upgrade",session:e.session})),a=!0,r.destroy(),o.emit("upgrade",s)})})),t.each(["send","close","poll","ping","destroy"],function(e,t){i[t]=function(){var e=(a?s:r)[t];return e?e.apply(null,arguments):i}})},x.upgrade.supported=t.support.cors||e;var T=e?require("ws"):window.WebSocket||window.MozWebSocket;if(x.websocket=function(e,o,n){var a,i=e.replace(/^http/,"ws"),r=this,s={};t.extend(r,{send:function(l,c){var d=s.readyState;if(0!==d){if(1==d)return l&&(s.send(l),a=l),c&&c();s=new T(i),window.mootsocket=s,s.onopen=function(){d=s.readyState,s.onmessage=function(e){n(e.data),a=null},s.onclose=function(e){s={},!e.wasClean&&a?r.send(JSON.stringify({method:"rpc.upgrade",session:o.session()}),function(){r.send(a)}):o.is_destroyed||o.close()},s.onerror=function(a){d=s.readyState,3!=d&&l&&(o.log("socket error",{err:a,msg:l,state:d}),t.post(e,l,n,"json").done(function(e){o.log("socket fix",{ret:e,msg:l})}))},l&&s.send(l),c&&c()}}},destroy:function(){1==s.readyState&&s.close()},ping:function(e){return r.send(null,e),{fail:t.noop,abort:t.noop}}})},x.websocket.supported=!!T,!e&&T){var C=navigator.userAgent.toLowerCase(),z=navigator.appVersion.split("Version/")[1];T&&t.browser.webkit&&!/chrome/.test(C)&&z&&"5.1.14">z.split(" ")[0]&&(x.websocket.supported=!1),t.browser.mozilla&&t(document).keydown(function(e){27==e.which&&e.preventDefault()})}x.xdomain=function(e,o,n){function a(e,o,n,a){var i=l[e];return i||(i=l[e]=new XDomainRequest,i.onerror=t.noop,i.ontimeout=t.noop,i.onprogress=t.noop),i.open(a||"post",e),i.onload=function(){var e=i.responseText;try{e=JSON.parse(e)}catch(t){}n(e)},i.send(o),i}var i,r=this,s={},l={};r.send=function(t){a(e,t,n)},r.destroy=function(){i&&(i=!1,s.abort())},r.poll=function(e,l){o.is_destroyed||(r.destroy(),i=!0,s=a(e,t.param(l),function(t){i=!1,n(t),setTimeout(function(){t.error||r.poll(e,l)},200)}),s.onerror=function(){console.error("xdomain",JSON.stringify(arguments[0])),o.is_destroyed||o.close()})},r.ping=function(t){var o=a(e+"/ping?"+Math.random(),"",t,"get");return{fail:function(e){o.onerror=e},abort:function(){o.abort()}}}},x.xdomain.supported=window.XDomainRequest,n(function(e){var t,o,n=3e4,a=this;a.conf,a.on("receive heartbeat",function(){t=+new Date}).on("close reconnect",function(e){a.is_closed="close"==e}).ready(function(){if("file:"!=location.protocol&&"localhost"!=location.hostname||navigator.onLine){var i;o=o||setInterval(function(){navigator.onLine!==!1||a.is_closed?a.is_closed===!0&&navigator.onLine!==!1?(i&&i.abort(),i=e.ping(a.reconnect)):a.is_closed||(t=t||+new Date,+new Date-t>n&&e.ping(function(){t=+new Date,a.poll()}).fail(a.close)):a.close()},1e3)}}).destroy(function(){clearInterval(o)})}),t.fn.jsonrpc=function(e){var o=0;return this.each(function(){var n=t(this),a="#multipart-rpc-"+o++,i=t(":input[name]",n),r=(t("<iframe/>",{name:a,src:"about:blank"}).hide().insertBefore(n),t("<input/>",{type:"hidden",name:"jsonrpc"}).appendTo(n)),s=t(window);n.attr({action:e.api,method:"post",target:a,enctype:"multipart/form-data"}),n.submit(function(){var o=e.params||{};i.filter(e.query||"*").each(function(){this.disabled||(o[this.name]=t(this).val())}),i.prop("disabled",!0).filter(":file").each(function(){this.disabled=!this.value}),r.val(JSON.stringify({session:e.session,method:e.method,params:[o],jsonrpc:"2.1.0",transport:"iframe",id:a})),s.on("message."+a,function(e){try{var t=JSON.parse(e.originalEvent.data),o=t.result||t.error;t.id==a&&(i.prop("disabled",!1),n.trigger(t.result?"done":"fail",o).trigger("always",o),s.off("message."+a))}catch(e){}})})})};var j=1,A=26,q=36,$=38,S=700,O=128,D=72,L=2.718,I=e?require("url").parse:function(e){var t=document.createElement("a");t.href=e;var o=t.pathname;return"/"!=o[0]&&(o="/"+o),{href:e,pathname:o,port:1*t.port||"",hostname:t.hostname,hash:t.hash,search:t.search,protocol:t.protocol}};m.urlify=p;var F=[],H={};e?module.exports=m:window.moot=m,b.prototype=[],m(function(e){function o(e){for(var t=0;n.length>t;t++)if(n[t].path==e)return t;return-1}if(e.users){var n=e.users.online,a=e.admins||[];e.users.find=function(e){return n[o(e)]},e.users.isAdmin=function(e){if(e)for(var t=0;a.length>t;t++)if("@"+a[t].username==e.path)return!0},t.each(n,function(){e.users.isAdmin(this)&&(this.is_admin=!0)}),e.channel.on("enter",function(t){t&&(t.is_admin=e.users.isAdmin(t),n.push(t))}).on("leave",function(e){if(e){var t=o(e.path);t>=0&&n.splice(t,1)}}).on("away return",function(t,o){o&&(o=e.users.find(o.path)),o&&(o.is_active="return"==t)}).on("enter leave away return",function(t,o,n){e.users.anon_count=n})}});var E=400*L,U=40*L,M=30*L,N=20,R=/\[#(.+)\/#\]/g,W=/-{3,} *(\w*)/g;m.fixTitle=function(e){return e=t.trim(e).replace(R,"$1"),t.each(e.split(/\s+/g),function(t,o){o.length>M&&!/https?:\/\//.test(o)&&(e=e.replace(o,o.slice(0,M)+" "+o.slice(M,2*M)))}),e},m.fixBody=function(e,t){if(e=m.fixTitle(e).replace(/\n{2,}/g,"\n\n"),!t)return[e];var o=e.slice(0,E),n=e.slice(o.length);n.length&&U>n.length&&(o=e.slice(0,E-U));var a=N+o.split(W).length/2,i=e.split("\n");return i.length>a&&(o=i.slice(0,a).join("\n").slice(0,E)),n=e.slice(o.length),o=[o],n&&o.push(n),o}}(!this.top,jQuery),!function(e,t){"use strict";function o(e){return e&&e.replace(I,function(e,t,o){return"8)"==o&&"\n"==t?t+o:"<i>"+t+L[o]+"</i>"})}function n(e,t){return e&&(e=e.replace(O,"&lt;$1$2$3"),t&&(e=e.replace(D,"<mark>$1</mark>"))),e}function a(e){return e?e.replace(/[\<\>]/g,""):""}function i(e){return e?e.replace(H,"&hellip;").replace(E,"&#8220;$1&#8221;").replace(U," &#8216;$1&#8217;").replace(W,"&mdash;").replace(P," &ndash; "):""}function r(e){return e=i(e).replace(R,"<em>$1</em>").replace(M,function(e,t){return/\s/.test(t)?"<em>"+t+"</em>":"<strong>"+t+"</strong>"}),e=g(e),e=o(e)}function s(e){if(!e)return"";var o="";return t.each(e.split(N),function(e,t){o+=e%2?"<samp>"+t+"</samp>":r(t)}),o}function c(e){return e.replace(/<(\w{1,2})"([\w\- ]+)"([^>]*)>/g,function(e,t,o,n){return o="m-"+o.split(" ").join(" m-"),"<"+(J[t]||t)+' class="'+o+'"'+n+">"}).replace(/<(\/?)(\w)>/g,function(e,t,o){return"<"+t+J[o]+">"})}function d(e){var t=new Date,o=moot.language,n=(t-e)/1e3,a=Math.floor(n/86400),i=Math.ceil(a/7),r=0>=a&&(60>n&&o.now||3600>n&&Math.floor(n/60)+o.min||86400>n&&Math.floor(n/3600)+o.hour)||7>a&&a+o.day||10>i&&i+o.week;if(r)return r;var s=new Date(e),l=s.getYear();return B=B||o.months.split(","),s.getDate()+" "+B[s.getMonth()]+(l!=t.getYear()?" "+(l+1900):"")}function u(e){return""+new Date(e)}function p(e,t){return(K[e]=K[e]||Function("_","return '"+e.replace(/\{([^\}]+)\}/g,"'+ (_.$1 === undefined ? '' : _.$1) +'")+"'"))(t)}function m(e,o){var n=t.extend({},o||{},{l:moot.language}),a=q[e];n.time&&(n.prettyTime=d(n.time),n.fullTime=u(n.time));try{return p(a,n)}catch(i){console.error(e,a,i,n)}}function f(e,o){if(e=e.replace(/<\/?mark>/g,"").replace(/<\/?em>/g,"_"),Q.test(e.split("?")[0])){var n="m-image",a=e.split("?")[0].split("/").slice(-1)[0];return e.split("flickr.com")[1]?n+=" m-flickr-link":e.split("dropbox.com")[1]&&(e=e.replace("www.dropbox","dl.dropbox"),n+=" m-dropbox-link"),a.length>27&&(a=a.slice(0,10)+"&hellip;"+a.slice(-18)),"<a class='"+n+"' href='"+e+"'>"+(o||a)+"</a>"}var i=e,r="class='m-link";"http"!=e.slice(0,4)||e.split(location.host)[1]?(r+=" m-local-link",i=i.replace(RegExp("https?://"+location.host),"").replace(location.pathname,""),"#!/"==i.slice(0,3)&&(r+=" m-moot-link",e=i,i=i.slice(3)),r+="'"):(i=i.split("://")[1],t.each(V,function(t,o){var t=e.indexOf(o);return-1!=t?("google.com"==o?(i=i.split("q="),i=i[1]?i[1].split("&")[0]:i[0]):(i=e.slice(t+o.length+1),/wikipedia/.test(o)?i=i.replace("_"," "):"d.pr"==o&&(r+=" m-image","+"!=e.slice(-1)?e+="+":i=i.slice(0,-1))),r+=" m-"+o.split(".")[0]+"-link'",!1):void 0}),r+="' target=_new "),i.length>40&&("/"==i.slice(-1)&&(i=i.slice(0,i.length-1)),i=i.split("/"),i=i[1]?i[0]+"/&hellip;/"+i.slice(-1)[0].slice(-27):i[0].slice(0,27)+"&hellip;");var s=e.slice(-1);return("."==s||","==s||")"==s&&-1==e.indexOf("("))&&(e=e.slice(0,-1)),"<a "+r+" href='"+e+"'>"+(o||i)+"</a>"}function g(e){return e.replace(G,function(e,t,o){return o=o.split(/[\s\'\"]/)[0].replace(/&#\w+;?/g,""),o.toLowerCase().indexOf("script:")>=0?t:f(o,t)}).replace(Y,function(e,t){if(t)return e;var o=e.split("&#82");return o[1]?f(o[0])+"&#82"+o[1]:f(e)})}function h(e,o,n){var a=window,i=(a.screenX||a.screenLeft)+(t(a).outerWidth()-o)/2,r=(a.screenY||a.screenTop)+50,s="left="+i+",top="+r+",resizable=0,location=0,status=0,scrollbars=0,dialog=0";
a.open(e,"moot_popup",s+",width="+o+",height="+n)}function v(e){return e=parseInt(e,10),e>=10?e:"0"+e}function b(e){e=e||0;var t=(Math.floor(e/3600),Math.floor(e/60));return e-=60*t,t+":"+v(e)}function y(e,o,n){e&&e.length&&(t("html, body").animate({scrollTop:e.offset().top-(o||200)},400,n),e.mootboost())}function w(e){var o=t(m("more")),n=o.eq(0),a=o.eq(2),i=o.eq(1),r=t("a",i).tooltip2({prefix:"m-",position:"right"}),s=t(".m-tooltip",r.eq(1)),l=t("em",r).text("+"+e.available);return e.available>26&&(i.ac("big"),s.text(moot.language.show_new)),r.click(function(){var o=t(this).ac("loading"),r=o.hc("to-head"),c=r?n:a,d={};d[r?"paddingBottom":"paddingTop"]=75*Math.min(e.available,10),c.animate(d),e.more(r,function(n){o.rc("loading"),l.text("+"+e.available),c.stop().css({padding:0}),r||n.reverse(),t.each(n,function(e,t){t=t.is_gap?w(t):x(t),t.is_gap||t.mootboost(),c[r?"append":"prepend"](t)}),10>e.available&&(i.rc("big"),s.text(moot.language.show_more)),e.available||i.remove()})}),o}function k(e,a){function r(e){return e.join("").replace(D,"$1")}function s(){var e;t(".m-seed, .m-reply:not(.m-preview)",g).each(function(){var o=t(this),n=t(".m-facelink img",this).attr("title");e&&n&&o.tc("followup",e===n),e=n})}function l(o){var n=t(".m-replies, .m-seed .m-body-wrap, .m-form",g);o?(g.ac("animating expanded").rc("collapsed"),n.mootslide(200,function(){g.rc("animating")})):n.slideUp(100,function(){g.rc("expanded").ac("collapsed"),t(this).css({display:""})}),e.is_expanded=o}var c=e.app,p=e.seed,f=window.moot.language,g=t(m("moot",t.extend({},e,p))),h=t(".m-replies",g),v="search"==a.type;g.data("moot",e),e.root=g.mousemoved("moot-hover").tc("flat",!!e.is_commenting),g.prepend(x(p,!0));var b=t(".m-seed",g);return e.is_expanded||g.ac("collapsed"),e.on("expand",!0,function(){var o=t(".m-follow",b).tooltip2({prefix:"m-"}).click(function(){return o.ac("loading"),e.followToggle(),!1})}).on("follow unfollow expand",!0,function(o){var n=e.is_followed;t(".m-follow",b).rc("loading hovered").tc("followed",n).find(".m-tooltip").text(f[n?"unwatch":"watch"]),c.user.emit(o)}),e.on("load",e.is_expanded,function(o){var n="load"==o||o.seed;if(g.ac("expanded").rc("loading collapsed"),n){var a=x(e.seed,!0);b.replaceWith(a),p.root=b=a}t.each(e.replies,function(e,t){h.append(t.is_gap?w(t):x(t))}),n&&(l(!0),s())}).on("collapse",function(e){e&&l(!1),t(".m-new_count",b).hide()}).on("remove",function(e,o){if(e.is_own&&!o){var n=e.is_seed?t(".m-create textarea",c.root):t("textarea",g);e.is_seed?(n.eq(0).val(r([e.title])).focus(),n.eq(1).val(r(e.body))):(n.val(r(e.body)).focus().keydown(),n[0].select())}}).on("before:reply",function(e){c.user.is_admin||t(".m-remove",g).remove(),x(e).appendTo(h),e.root.ac("created"),e.on("key",function(){setTimeout(function(){e.root.rc("created")},500)})}).on("reply",function(o){o.from_channel&&e.is_loaded&&(c.user.is_admin||t(".m-remove",g).remove(),x(o).appendTo(h).mootslide()),o.is_own&&t(".m-is-new",g).rc("is-new")}).on("type",function(o){var n=t("<em/>").ac("typing").appendTo(t(".m-actions:first",g)),a=t(".m-writing",g);e.is_expanded&&a.html(m("writing",{user:o})),setTimeout(function(){n.remove(),a.empty()},1e3*Z)}).on("*",!0,function(r){if("type"!=r){var l=e.reply_count,m=(e.new_count,(e.is_expanded?p.time:e.lastReply)||p.time);t(".m-reply_count",b).toggle(l>0).text(l).tc("has_replied",!!e.has_replied),c.is_commenting&&(l&&t(".m-comment_count",g).text(l+" "+f["comm_count_"+(l>1?"n":"1")]),g.tc("first-comment",!l),p.like_count||p.is_liked||t(".m-like",p.root).text(f.likepost));var h=t(".m-time",b).text(d(m)).attr({title:u(m),"data-time":m}).tooltip2({prefix:"m-",timeout:500});t(".m-title",b).html(o(i(n(p.title,v)))),"moot"!=a.type&&t(".m-permlink",g).tooltip2({prefix:"m-"}).add(h).attr("href","#!"+e.path.replace(c.path,"")),e.page&&"page"!=a.type&&t(".m-cat",b).html(f.in_forum+" <a>"+e.page.title+"</a>").find("a").click(function(){return e.is_expanded?(c.load(e.page.path),!1):void 0}),s()}}),c.is_commenting||"moot"==a.type||g.click(function(o){if(!g.hc("loading")){var n=e.is_loaded,a=t(o.target);if(e.is_expanded)a.closest(".m-title").length&&(e.collapse(),n&&l(!1));else if(!a.closest(".m-follow").length)return e.expand(),n?l(!0):g.ac("loading"),!1}}),g}function x(e,o){e.user.displayname=a(e.user.displayname);var n=e.app,i=moot.language,r=e.is_stub?t(".m-comment-head",n.root):t(m(o?"seed":"reply",e)),s=n.user.is_admin,l=e.moot.match_count>=0,c=t(".m-unspam",r);return n.is_forum||t(".m-facelink",r).removeAttr("href"),e.uploads=z(e.body.join("")),t(".m-post",r).data("post",e),t(".m-time",r).tooltip2({prefix:"m-",timeout:500}),e.user.is_admin&&t(".m-name",r).after(t("<span/>",{text:i.admin}).ac("admin")),e.root=r.mousemoved(),e.is_new&&r.ac("is-new"),t(".m-body",r).on("render",function(){function o(t){a.html(moot.format(e.body,t,l)),r.tc("closed",!t).tc("opened",t),s.html((t?i.less:"")+"&hellip;"),n.emit("format",a,e)}var a=t(this),r=a.parent(),s=t(".m-show-all",r),c=e.is_expanded;a.html(moot.format(e.body,c,l)),n.emit("format",a,e),(e.has_more||e.body[1])&&(r.ac("expandable "+(c?"opened":"closed")),s.html((c?i.less:"")+"&hellip;").click(function(){e.is_loaded?o(!e.is_expanded):s.ac("loading"),e.toggle(!e.is_expanded)})),e.on("more",function(){s.rc("loading"),o(!0)})}).trigger("render"),t(".m-heart",r).each(function(){function o(o,n){arguments.length||(o=e.like_count,n=!!e.is_liked);var r=o;n&&(o--,r=o?"+"+o:""),s.text(n?i.unlike:i.like),a.tc("has-likes",!n&&o>0).tc("is-liked",n).toggle(!!o||n),t("strong",a).text(o?r:"")}var a=t(this),s=t(".m-like",r),l=t(".m-like_list",r).active2("m-");n.user.is_logged&&s.click(function(){var t=!e.is_liked;o(e.like_count+(t?1:-1),t),e.likeToggle()}),e.on("like unlike spam",!0,function(n){o(),"inline"!=n&&a.mootboost(400),"spam"==e.flag&&s.remove(),("inline"!=n||e.is_liked)&&t(".m-remove",r).remove()}),a.click(function(){e.moot.is_expanded&&(a.ac("loading"),l.empty(),e.whoLikes(function(e){var o=a.rc("loading").offset();t.each(e,function(){l.append(m(n.is_forum?"face":"img",{user:this}))}),l.trigger("open").css({opacity:0}),setTimeout(function(){var e=o.left,t=l.outerWidth()/2,n=o.left>t;n&&(e+=a.outerWidth()/4-t),l.tc("edged",!n).css({opacity:""}).offset({top:o.top-l.outerHeight()-a.outerHeight()/2,left:e},10)})}))})}),t(".m-remove",r).each(function(){if(!n.user.is_logged)return t(this).add(c).remove();var o,a=t(this).tooltip2({prefix:"m-"}),l=t("<span>"+i.thanks+"</span>").ac("thanks"),d=1e3*60*Z-Math.max(0,+new Date-e.time),u=e.user.path==n.user.path,p=e.removable(),f=t(".m-tooltip",a),g=t(".m-icon",a);p?s||(setTimeout(function(){u?a.remove():(p=!1,f.text(i.mark))},d),u&&d>0&&(g.text("i"),o=setInterval(function(){f.text(i.removepost+" "+b(d/1e3)),d-=1e3,0>o&&clearInterval(o)},1e3))):((e.flag||e.is_own)&&a.hide(),f.text(i.mark),g.text("!")),a.click(function(o,s){if(o.preventDefault(),!u&&!s){var c=t(m("prompt")).appendTo(n.root).active2("m-").trigger("open");return t(".m-h2",c).text(i[p?"removepost":"mark"]+"?"),t("button, a",c).click(function(){c.remove()}).filter("button").click(function(){a.trigger("click",[!0])})}p?(r.ac("loading"),e.remove(function(){s||r.remove()})):(a.parent().append(l),e.spam(function(){setTimeout(function(){l.remove()},2e3)}))}),s||!e.is_own&&!e.flag||c.remove(),c.click(function(){e.unspam(function(){a.remove(),c.replaceWith(l),setTimeout(function(){l.remove()},2e3)})})}),e.on("spam unspam",e.spam_level,function(o,n){var a=n>=1;r.tc("is-spam",a),e.is_seed&&e.moot.root.tc("is-spam",a),a&&!r.hc("is-spam")&&t(".m-body",r).trigger("render")}).on("remove",function(){r.fadeOut(function(){r.remove()})}),r}function _(e,o){var n=t("textarea",e),a=n.eq(0),i=n.last();moot.language,n.placeholder2("m-").keydown(function(o){var n=o.which;return 27==n?a.trigger("away").blur():(13==n&&(o.ctrlKey||o.metaKey)&&(o.preventDefault(),t("button",e).click()),void 0)}).focus(function(){t(document).one("mousedown",function(o){t(o.target).closest(e)[0]||a.trigger("away")})}).keypress(function(t){String.fromCharCode(t.which)&&o.user.type(a.val()+i.val(),e.closest(".m-moot").data("moot"))}),i.keydown(function(e){var t=e.which,o=this,n=o.selectionStart,a=o.value;9!=t||!n||e.ctrlKey||e.shiftKey||(e.preventDefault(),o.value=a.substring(0,n)+"   "+a.substring(o.selectionEnd),o.focus(),o.selectionEnd=n+3),86==e.which&&(e.ctrlKey||e.metaKey)&&setTimeout(function(){i.keyup().keydown()},50)});var r=t(".m-help",e).active2({prefix:"m-",trigger:t(".m-show-help",e)},function(){n[1]||r.css({top:-r.outerHeight()-10})});t.cookie2("moot.tip")||a.one("click",function(){r.trigger("open"),t.cookie2("moot.tip",1)}),a.trigger("away"),T(e,a,i,o),C(e,i,o)}function T(e,a,r,s){var l=e.hc("create"),c=t(m("preview")).appendTo(e).ac(l?"seed":"reply"),d=t(".m-title",c),u=t(".m-body",c),p=t(".m-name",c),f=moot.language,g=s.user,h=u.parent(),v=u.next().html("&hellip;");t(".m-face",c).attr("src",g.img),p.text(g.displayname),g.is_admin&&p.after(t("<span/>",{text:f.admin}).ac("admin")),a.keyup(function(){e.tc("filled",!!a.val())}),l&&a.keyup(function(e){if(-1==t.inArray(e.which,nt)){var a=o(i(n(moot.fixTitle(this.value),!1)));d.html(a)}}),r.keyup(function(e){if(-1==t.inArray(e.which,nt)){var o=t(this).val(),n=h.hc("opened"),a=moot.fixBody(o,!n),i=!!a[1]||n;u.html(moot.format(a.slice(0,n?2:1))),s.emit("format",u,{uploads:z(a.join(""))}),h.tc("expandable",i)}}),a.add(r).keydown(function(e){if(86==e.which&&(e.ctrlKey||e.metaKey)){var o=t(this);setTimeout(function(){o.trigger("keyup")},10)}}),v.click(function(){h.tc("closed opened"),v.html((h.hc("opened")?f.less:"")+"&hellip;"),r.triggerHandler("keyup")}),a.on("away",function(){a.add(r).trigger("keyup")})}function C(e,o,n){function a(n){n.preventDefault();var a=n.target.files||n.originalEvent.dataTransfer.files||[];t.each(a,function(n,s){if(/image/.test(s.type)&&4e6>s.size){l.hide();var c=new FileReader;c.onload=function(e){var i=s.name.replace(/[^\w\.]/g,"").toLowerCase(),l=s.name.split("."),c=l[0],d=it[i];if(s.altname=i,s.data=e.target.result,d&&d.data!=s.data&&(c=l[0]+"-"+n,i="file_"+n+i,s.altname=i),o[0].value+=" ["+c[0].toUpperCase()+c.slice(1)+"]("+i+")",it[i]=s,n==a.length-1){var u=t.trim(o.val())+" ";o.keyup().focus().val("").val(u)}r.val("")},c.readAsDataURL(s)}else l[0]||(l=t("<div/>").ac("tooltip imgtip").text(i.max).prependTo(e)),l.show()})}if(n.conf().upload===!1&&(rt=!1),rt){var i=moot.language,r=t("<input/>",{type:"file",multiple:"multiple",accept:"image/*"}).ac("hidden").appendTo(e),s=t("<a/>",{title:i.upload}).ac("post-upload").append("<em>U</em>"),l=t(".imgtip",e);s.prependTo(t(".m-controls",e)).tooltip2({prefix:"m-"}),r.change(a),s.click(function(){r.click()}),e.on("drop",a).on("dragover dragleave drop",function(t){t.preventDefault(),e.tc("dragged",/over/.test(t.type))})}}function z(e){var t=[];return rt&&e&&e.replace(G,function(e,o,n){var a=it[n];a&&t.push(a)}),t}function j(e){return e&&e.replace(/["']/g,"")}function A(e){var t=dt.css({fontFamily:"'"+e+"'"}).appendTo("body").width();dt.css({fontFamily:"'"+e+"', monospace"});var o=t==dt.width();return dt.remove(),o}var q={logo:'<d"logo"><a title="{l.slogan}" href="https://moot.it/" target="_top"><em>m</em></a></d>',online:'<d"users"><d"h3 users-title">{l.online}<em/></d><d"logged-users"/><d"anon-count"/></d>',forum:'<d"header"><d"wrap"><d"table"><d"navi"><a"nav-feed" href="#!/feed"><s>{l.feed}</s><em"newcount"/></a><a"nav-all" href="#!/"><s>{l.all}</s><em"newcount"/></a><a"nav-forums"><s>{l.forums}</s></a><a"nav-online"><s>{l.online}</s><em/></a></d><d"subnavi"><d"search" id="m-search"><input type="text" name="q" placeholder="{l.search}"></d> @account; </d></d></d></d><d"wrap"> @page; <d"sidebar"><d"forums-wrap"><d"h3 forums-title">{l.forums}</d><d"forums links"/><d"custom links"/><d"admin-area"/></d></d></d>@logo;',commenting:'<d"comment-head"><d"comment-meta"><d"seed"><a"action heart"><s>a</s><strong/></a><a"like"/><a"follow"><s"icon">e</s><strong/></a></d><d"like_list"/> @account; </d><d"comment_count"/></d>@page;@logo;',threaded:"@account;@page;@logo;",page:'<p"message"/><d"page"><d"pagetitle"><div/></d><s"loading-text">{l.loading}</s> @create; <p"collapse-all"><a><em"icon">u</em> {l.collapse}</a></p><d"list"/><b"more-moots button"/></d>',navi:'<p><a href="{href}">{title}</a></p>',admin:'<d"h3 manage-title">{l.manage}</d><d"links"><p><a"nav-settings">{l.settings}</a></p><p><a"nav-spam" href="#!/spam">{l.spam}</a></p><p><a"nav-designer">Designer <s"badge">NEW!</s></a></p></d><d"subs"><d"h3 subs-title">{l.subs}</d><d"links"><p"yup">{l.basic}</p><p"sub-branding">{l.branding}</p><p"sub-sso">{l.sso}</p></d><a"button" href="https://moot.it/upgrade/" target="_new">{l.upgrade_link}&hellip;</a></d>',gallery:'<div id="m-gallery"><a"close">x</a><nav id="m-navi"/><div id="m-media"><img id="m-img"/></d></d>',browser:'<d"h2">{l.slogan}</d><a href="https://moot.it"><img src="//moot.it/m/img/home/allscreensizes.png"/></a><p><a href="http://browsehappy.com/">{l.upgrade}</a> {l.upgrade2}</p>',unverified:'<p"msg unverified"><em>{l.unver1}</em> {l.unver2}</p>',img:'<i"face" src="{user.img}" title="{user.displayname}">',face:'<a"facelink" href="#!/{user.path}" data-href="#!/{user.path}" title="{user.displayname}">@img;</a>',growl:'<d"growl"><a"destroy">x</a><d"entries"/></d><s"growlicon">L</s>',event:'<d"entry" data-path="{path}"> @face; <d"data"><d"meta"><r"name">{user.displayname}</r><s"time" data-time="{time}" title="{fullTime}">{prettyTime}</s></d><a"link">{title}</a></d></d>',help:'<a"show-help">?</a><d"help"><a"close">x</a><d"help-format"><d"help-bolded">*<s>{l.bold}</s>* ({l.single})</d><d"help-italics">_<s>{l.italics}</s>_</d><d>&gt; <s>{l.help3}</s></d><d"help-monospaced">`<s>{l.monospaced}</s>`</d><d>[<s>{l.title}</s>](<s>{l.link}</s>)</d></d><d"help-code"><d>&#45;&#45;&#45;</d> {l.help5} <d>&#45;&#45;&#45;</d><d>&#45;&#45;&#45; html</d> &lt;p&gt;{l.help6}&lt;/p&gt; <d>&#45;&#45;&#45;</d></d><d"help-post"><em>ctrl</em> + <em>&crarr;</em><s>&nbsp; {l.help2}</s></d></d>',meta:'<d"meta"><s"name">{user.displayname}</s><a"time" data-time="{time}" title="{fullTime}">{prettyTime}</a><s"cat"/><s"spammed">{l.spam}</s><s"actions"><s"reply_count"/><a"action heart"><s>a</s><strong/></a><a"follow"><s"icon">e</s></a><a"action remove" title="{l.removepost}"><s"icon">x</s><s"tooltip"></s></a></s></d><d"like_list"/>',body:'<d"body-wrap"><d"body"/><a"show-all"/><a"action like"/><a"action unspam">{l.unspam}</a></d>',seed:'<d"seed"> @face; <d"post"> @meta; <a"permlink" title="{l.fullview}"><em>7</em></a><d"title"></d> @body; </d></d>',reply:'<d"reply"> @face; <d"post"> @meta; @body; </d></d>',prompt:'<d"mask prompt"><d"panel"><d"h2"/><b>{l.yes}</b><a>{l.cancel}</a></d></d>',more:'<d"head"/><d"get-replies"><a"to-head button" title="{l.show_old}"/><a"to-tail button" title="{l.show_more}"><em/></a></d><d"tail"/>',preview:'<d"preview expanded"><d"facelink"><i"face"><s"typing"/></d><d"post closed"><s"preview-title">{l.preview}</s><d"meta"><s"name"/><s"time">{l.now}</s></d><d"title"/> @body; </d></d>',moot:'<d"moot"><d"replies"/><d"form replyform"> @help; <textarea placeholder="{l.reply}"/><d"controls"><button title="{l.enter}">{l.replybtn}</b></d><d"writing"/></d></d>',writing:'<d"facewrap"> @img; <em"typing"/></d><s>{user.displayname} {l.writing}</s>',create:'<d"form create"> @help; <d"input-wrap"><t"input-title" rows="1"></t><t"input-body" rows="1"></t></d><d"controls"><d"select"><l>{l.select}</l><d"options"><r>{l.select}</r><ul/></d><input/></d><button title="{l.enter}"/></d></d>',account:'<d"nav-account"><a"login">{l.login}</a><a"me"><s"myname"/><em"down">5</em>@img; </a></d>',account_overlay:'<d"account overlay"><a"close">x</a><i"face"/><f"upload" target="m-upload" title="{l.avatar}"><input type="file" name="img" size="1"><b>x</b></f><d"names"><d"h3"><strong/> &bull; <a"logout">{l.logout}</a></d><d"h2"/><p"status"><s>o</s><em/> &bull; <a/></p></d><f><d"h3">{l.name}</d><s"error"/><input type="text" class="m-input" name="displayname" maxlength="50"><p>{l.nametip}</p></f><f><d"email-updated"><d"h3">{l.step}</d><p>{l.step1}</p></d><d"field email"><d"h3">{l.email}</d><s"error"/><input name="email" class="m-input" type="email" maxlength="100"><p>{l.emailtip}</p></d></f><p"unfollow"><s>e</s><em/> &bull; <a>{l.unwall}</a></p><l"maillist"><input type="checkbox"/> {l.notify} <em>{l.saved}</em></l><p"password"><a>{l.changepw}</a></p></d>',join:'<d"mask join-mask"><d"panel moot-join"><d"h2">{l.welcome}!</d><p>{l.welcome1}</p><b>{l.later}</b></d></d>',social_join:'<d"mask join-mask"><f"panel join"><i"face" /><d"h2">{l.welcome}, <span/>!</d><d"h3">{l.welcome2}</d><l"field username"><input name="username" class="m-input" required="required" placeholder="your-username" maxlength="40"><em"tip">{l.unametip}</em></l><l"terms"><input type="checkbox" name="terms" required="required" /> {l.terms} </l><p><button disabled>{l.join}</b></p></f></d>',confirm_password:'<d"h2">{l.changepw}</d><br><p><b>{l.change}</b></p>',confirm_email:'<d"h2">{l.c_email}</d><d"h3"/><p><b>{l.ok}</b></p>',confirm_account:'<d"h2">{l.c_acc}</d><d"h3">{l.c_acc1}</d><p><b>{l.ok}</b></p>',expired:'<d"h2">{l.expired}</d><p>{l.expired1}</p><p><b>{l.ok}</b></p>',confirm_error:'<d"h2"/><p><b>{l.ok}</b></p>'};t.fn.active2=function(e,o){"string"==typeof e&&(e={prefix:e}),e=t.extend({prefix:"is-"},e);var n=e.prefix+"active",a=e.trigger||t(),i=t("body"),r=t(document);return this.each(function(){function s(){l.hasClass(n)&&(l.trigger("close"),r.off(".a2"))}var l=t(this);a.click(function(){l.trigger(l.hasClass(n)?"close":"open")}),l.on("open close",function(c){if(!c.isDefaultPrevented()){var d="o"==c.type[0];i.ac("overlaid"),l.toggleClass(n,d),i.toggleClass(e.prefix+"overlaid",d),d&&(o&&o(l,a),r.on("mouseup.a2 keydown.a2",function(e){var o=t(e.target);o.closest(a)[0]||(27==e.which||"mouseup"==e.type&&!o.closest(l)[0])&&s()}))}}),t("."+e.prefix+"close",l).click(s)})},t.fn.autogrow=function(e){var o="minHeight,maxHeight,fontSize,fontFamily,lineHeight,fontWeight,padding".split(",");return this.each(function(){var n=t(this),a=n.next(".jqt-shadow"),i=n.is("textarea");n.one("keydown",function(){a=t("<"+(i?"div":"span")+"/>").attr("class","jqt-shadow").insertAfter(n),t.each(o,function(e,t){a.css(t,n.css(t))}),a.css({position:"fixed",top:"-9999em"}),i&&a.width(n.width())}).keydown(function(){setTimeout(function(){var t=n.val();a.html(t?t.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/&/g,"&amp;").replace(/\n$/,"<br/>&nbsp;").replace(/\n/g,"<br/>").replace(" ","&nbsp;"):"-"),i?n.height(a.outerHeight()+(t?e||0:0)):n.width(a.outerWidth())},1)})})},t.fn.changed2=function(){return t(":input[name]",this).change(function(){t(this).data("changed2",!0)}),this},t.expr[":"].changed=function(e){return!!t(e).data("changed2")},t.fn.toObject=function(){var e={};return this.each(function(){this.disabled||(e[this.name]=t(this).val())}),e},t.fn.mousemoved=function(e,o){e=e||"is-hover",o=o||1e3;var n;return"ontouchstart"in window?this.addClass(e):this.each(function(){var a=t(this);a.on("mouseenter mouseleave",function(i){if(!t(i.relatedTarget).data("skip-hover")){var r="mouseenter"==i.type,s=0,l=0;a.toggleClass(e,r),r?(a.on("mousemove.jqt",function(t){l-t.pageX&&(a.addClass(e),s=new Date,l=t.pageX)}),n=setInterval(function(){new Date-s>o&&(a.removeClass(e),s=new Date)},1e3)):(a.off("mousemove.jqt"),clearInterval(n))}})})};var $="placeholder"in document.createElement("input");t.fn.placeholder2=function(e){return e=e||"",$?this:this.each(function(){var o=t(this),n=t("<span/>",{"class":e+"placeholder",text:o.attr("placeholder")});o.after(n).keyup(function(){o.parent().toggleClass(e+"filled",!!o.val())}),n.click(function(){o[0].focus()})})},t.fn.sel2=function(e,o){var n=e.prefix||"";return this.each(function(){function e(e){e=e||t("."+u,c),e.removeClass(u)}function a(e){r.trigger("select",[e]).trigger("close")}var i,r=t(this).active2(n),s=r.data("api"),l=t(document),c=t("div",r),d=n+"selected",u=n+"hovered";return s?s:(r.on("open",o).click(function(){r.trigger("open"),l.bind("keydown.s2",function(o){var n=o.which,i=40==n,r=t("."+u,c);(i||38==n)&&(r.length?(e(r),r=i?r.next():r.prev()):r=t("li:"+(i?"first":"last"),c));var s=String.fromCharCode(n);if(s&&"("!=s&&"&"!=s){var l=t("li",c).filter(function(){return t(this).text()[0].toLowerCase()==s.toLowerCase()}).eq(0);l[0]&&(e(),r=l)}if(r[0]){r.addClass(u);var d=r.position().top;(0>d||d>c.height())&&c.scrollTop(c.scrollTop()+(0>d?-1:1)*c.height()),(13==n||32==n)&&a(r)}o.preventDefault()})}),r.bind("close",function(){l.unbind("keydown.s2")}),r.on("select",function(e,o){"number"==typeof o&&(o=t("li",c).eq(o));var n=o.data("value");void 0===n&&(n=o.text()),t("."+d,c).removeClass(d),o&&o.addClass(d),r.toggleClass("is-defined",!!n),t("input",r).val(n).trigger("change"),t("label",r).html(o?o.html():n),r.data("value",n),i=n}),c.on("click","li",function(e){return a(t(e.target).closest("li")),!1}).on("mouseenter mouseleave","li",function(o){e(),t(o.target).toggleClass(u,/ee/.test(o.type))}),r.data("api",{val:function(e){return void 0!==e?a(t("li:contains("+e+")",r)):i},index:function(e){return void 0!==e?a(t("li",c).eq(e)):t("li",c).index(t("."+d,c))}}),void 0)})},t.fn.tooltip2=function(e){var o=e.prefix||"",n=o+"tooltip",a=o+"hovered";return"ontouchstart"in window?this:this.each(function(){var o,i,r,s,l=t(this),o=t("."+n,l);o[0]||(o=t("<span/>",{"class":n}).appendTo(l)),o.text(l.attr("title")),l.removeAttr("title").bind("mouseenter.tip2 mouseleave.tip2",function(c){var d=/ee/.test(c.type);if(o=t("."+n,l),d){r=l.outerWidth(),i=o.outerWidth(),s=setTimeout(function(){l.addClass(a)},e.timeout||0);var u="left"==e.position?{top:0,left:-i}:"right"==e.position?{top:"35%",left:r+5}:{top:-o.outerHeight(),left:-(i/2)+r/2};o.css(u)}else l.removeClass(a),clearTimeout(s)})})};var S=/(^|\n)[-`]{3,} *(\w*)/g,O=/<(\/?)([^3><]+)(>?)/g,D=/\[#([^\/]+)\/#\]/g,L={"<3":"a",":D":"D",":-D":"D",":d":"D",":-d":"D",":)":")",":-)":")",";)":";",";-)":";",":O":"O",":-O":"O",":o":"O",":-o":"O",":0":"O",":-0":"O",":*":"*",":-*":"*",":|":"|",":-|":"|",":(":"(",":-(":"(",":P":"P",":-P":"P",":p":"P",":-p":"P",":/":"/",":-/":"/",":'(":"'",":'-(":"'","8)":"8","8-)":"8",">:(":">",">:-(":">",">:O":"<",">:-O":"<",">:o":"<",">:-o":"<",">:0":"<",">:-0":"<"},I="";for(var F in L)I+=F.replace(/(\)|\||\*|\(|\/)/,"\\$1")+"|";I=RegExp("(^|\\s)("+I.slice(0,I.length-1)+")","g");var H=/\.{3,}/g,E=/\"([^\"]+)\"/g,U=/\s\'([^\']+)\'/g,M=/\*([^\*]+)\*/g,N=/`([^`]+)`/g,R=/_([^_]+)_/g,W=/-{2,}/g,P=/ - /g;moot.format=function(e,o,a){var i,r=e.slice(0,o?2:1).join(""),l=r.split(S),c=!0,d="";return t.each(l,function(e,o){if(0===(e+1)%3)return i=o;if(0===e%3&&(c=!c),o=t.trim(o),!o)return"";if(c)return d+=hilite2(t.trim(o.replace(D,"<mark>$1</mark>")),i,"m-");o=n(o,a),o=s(o);var r,l=(o+"\n").split("\n");t.each(l,function(e,o){o=t.trim(o),">"==o.slice(0,1)?(r||(d+="<blockquote>"),o=t.trim(o.slice(1)),r=!0):r&&(d+="</blockquote>",r=!1),(o||0!=e&&e!=l.length-1)&&(d+=o?t.browser.msie&&9>t.browser.version?o:"<p>"+o+"</p>":"<p class=m-empty/>")})}),d};var J={a:"a",b:"button",c:"code",d:"div",e:"fieldset",f:"form",i:"img",j:"iframe",l:"label",p:"p",r:"strong",s:"span",t:"textarea"};t.each(q,function(e,t){q[e]=c(t)});for(var X=0;2>X;X++)t.each(q,function(e,t){q[e]=t.replace(/\s*@(\w+);\s*/g,function(e,t){return q[t]})});var B,K={};moot.tmpl=function(e,t){return t=t||{l:moot.language},p(c(e),t)};var G=/\[([^\]]+)\]\(\s*([^\)]+)\s*\)/gi,Y=/https?:\/\/[^\s\"\']+(\')?/gi,Q=/(jpe?g|png|gif)$/i,V=["facebook.com","wikipedia.org/wiki","twitter.com","github.com","google.com","vimeo.com","youtube.com/watch?v","youtu.be","d.pr","dropbox.com"];moot("format",function(e){t(".m-link",e).each(function(){var e=t(this);if("m-link"==e.attr("class")){var o=e.attr("href").split("/").slice(0,3).join("/");e.removeAttr("class").ac("favlink").prepend(t("<img/>",{src:"//icon.moot.it/"+o}))}})}),t.each(["add","remove","toggle","has"],function(e,o){t.fn[o[0]+"c"]=function(e,t){return this[o+"Class"]("m-"+e.split(" ").join(" m-"),t)}}),t.fn.mootslide=function(e,o){return e=e||100*Z,this.each(function(){var n=t(this),a=n.css({opacity:0}).outerHeight();n.height(0).animate({height:a},e).animate({opacity:1,queue:!0},e,function(){n.css({height:"",opacity:""}),(o||t.noop)()})})},t.fn.mootboost=function(e){return this.each(function(){var o=t(this);o.ac("boosted"),setTimeout(function(){o.rc("boosted")},e||500*Z)})};var Z=2.718;moot(function(e){function o(e){n.tc("has-message","string"==typeof e),t(".m-message",n).text(e),e&&e.stack&&console.error(e.stack)}var n=e.root,i=e.conf(),r=moot.language;return e.is_stub&&!/moot.it/.test(location.host)?(n.html(e.name+" "+r.notexist+' <a href="https://moot.it/'+e.name+'">'+r.setup+" &raquo;</a>"),!1):(t.each(["forum","threaded","commenting"],function(t,o){e["is_"+o]&&n.html(m(o,{user:e.user})).addClass("is-"+o)}),e.is_threaded&&i.show_online&&n.prepend(m("online")),location.hash.split("#!")[1]&&e.on("load",function(o){var a="unread"==e.page.extra?t(".m-reply:last.m-is-new:first, .m-replies > :last",n):n;o.is_init&&a[0]&&t("html, body").animate({scrollTop:a.offset().top-30},300)}),setInterval(function(){t("[data-time]",n).each(function(){var e=t(this),o=e.data("time"),n=t("span",e);o&&e.html(d(o)+(n[0]?n[0].outerHTML:""))})},1e4*Z),e.on("error",o).on("waiting",function(e,t){t.on("progress",function(e){o(r.progress[e]),3==e&&setTimeout(o,1e3)}).done(function(){o()})}).on("destroy",function(){n.ac("destroyed")}),e.channel.on("*",!0,function(e){"close"==e?setTimeout(function(){o(r.reconnect)},100*Z):o()}).on("type",function(e){e.img?e.displayname=a(e.displayname):(e.img="//i2.wp.com/cloudinary-a.akamaihd.net/moot/image/upload/t_d2-avatar/v1364433564/moot.jpg?ssl=1",e.displayname=r.someone)}),void 0)}),moot(function(e){function o(){e.is_commenting||setTimeout(function(){var o=t.grep(e.page,function(e){return e.is_expanded});r.parent().tc("shown",o.length>1)},1)}var n=e.root,a=t(".m-list",n),i="created",r=t(".m-collapse-all a",n).click(function(){e.page.collapse()}),s=t(".m-more-moots",n).click(function(){e.page.more()});e.is_commenting&&r.parent().remove(),e.on("before:load",function(n){s.hide(),n.on("load more",function(e){s.text(n.available).css("display",n.available>0?"block":"none"),o(e)}).on("before:more more",function(e){s.tc("loading","more"!=e)}).on("before:moot",function(e){k(e,n).prependTo(a),e.root.ac(i)}).on("moot",function(r,s){if(r.root&&r.root.hc(i))setTimeout(function(){r.root.rc(i)},500*Z);else if(s){var l=k(r,n).prependTo(a);r.from_channel&&l.mootslide()}else k(r,n).appendTo(a);r.on("expand collapse",o);var c=r.page;"moot"==n.type&&c.title&&!e.is_commenting&&t("<a/>",{text:c.title}).ac("back").appendTo(a).click(function(){e.load(c.path)}),e.emit("topic",r,s)}).on("remove",function(e){e.root.fadeOut(function(){e.root.remove()})})})}),moot(function(e,o){function n(e){var t=e.split("@"),o="#!/"+(t[1]?"@"+t[1]:e.split("/").slice(2).join("/"));return o}function a(){var o=t(this);moot.admin?(moot.admin(e,i),o.trigger("click")):(o.ac("loading"),t.getScript("//cdn.moot.it/1.8.1/admin.min.js",function(){o.rc("loading"),moot.admin(e,i),o.trigger("click")}))}if(!e.is_commenting){var i=e.root,r=e.user,s=moot.language,l=t(".m-header",i),c=t(".m-page",i),d=t(".m-sidebar",i),u=(t(".m-navi",i),t(".m-nav-feed",i)),p=t(".m-forums-wrap",d),f=t(".m-forums",p),g=t(".m-forums-title",p),h=t(".m-custom",d),v=t(".m-nav-all",i),b=t(".m-list",i),y=t(".m-pagetitle div",i);if(i.off(".ml").on("click.ml","a[href^='#!']",function(o){if(!e.is_forum&&t(o.target).hc("face"))return!1;if(!o.metaKey&&!o.ctrlKey){o.preventDefault();var n=t(this),a=n.attr("href").slice(3);("feed"!=a||r.is_logged)&&(n.ac("loading"),e.load(a))}}),p.active2({prefix:"m-",trigger:t(".m-nav-forums",l)},function(e,t){var o=t.offset();e.offset({top:o.top+t.outerHeight()+10,left:o.left-(e.outerWidth()-t.outerWidth())/2})}),r.on("login logout",!r.is_logged,function(){u.attr("title",r.is_logged?"":s.login1)}),e.html){h.html(e.html);var w,k=[];t("a",h).each(function(){var o=t(this),a=o.attr("href");if(!a||"#!/"==a.slice(0,3)){var i=e.path+"/"+(a?a.slice(3):moot.urlify(o.text())),r={title:o.text(),path:i,href:n(i)};o.replaceWith(m("navi",r)),delete r.href,i.split("#")[1]||o.hasClass("non-category")||(e.getCategory(i)||(w=!0),f.add(g).remove(),k.push(r))}}),k.length&&k.length!=e.categories.length&&(w=!0),r.is_admin&&w&&e.setCategories(k),t(".moot-footer",h).remove().appendTo(d)}f[0]?e.on("categories",e.categories,function(o){o=o||e.categories,f.empty(),t.each(o||[],function(e,o){o=t.extend({},o,{href:n(o.path)});var a=t(m("navi",o)).appendTo(f);t("a",a).tc("has-new",!!o.has_new)})}):g.remove();var x=t(".m-admin-area",i);if(r.is_admin&&e.is_forum){x.html(m("admin")),t(".m-nav-settings",x).one("click",a),t("<a>"+s.edit+"</a>").ac("edit-cats").appendTo(g).one("click",a);var _=e.products||[];t(".m-subs p",d).each(function(e){var o=t(this),n=o.attr("class").split("m-sub-")[1];(0==e||t.inArray(n,_)>-1)&&o.ac("yup").one("click",a)}),2==_.length&&t(".m-subs",d).ac("has-all"),t(".m-nav-designer",x).click(function(n){n.preventDefault(),t("body").toggleClass("md-enabled"),t("#moot-designer")[0]||(t("head").append("<link href='//cdn.moot.it/1.8.1/designer.css' rel='stylesheet'>"),t("<div/>",{id:"moot-designer"}).appendTo("body").load("//cdn.moot.it/1.8.1/designer.html"),t.getScript("//cdn.moot.it/1.8.1/designer.min.js",function(){moot.designer(e,o)}))})}else x.remove();p.on("click",".m-links a",function(){p.trigger("close")}),e.on("before:load",function(o){b.empty().ac("loading"),i.attr("class",t.trim(i.attr("class").replace(/m-\w+page/,""))),i.rc(e.page.type+"page"),y.html(s.loading).css("display",""),t(".m-selected",i).rc("selected"),t("[href='"+n(o.path)+"']",i).add(c).ac("loading")}).on("load",function(e){var o=t("#m-search input",i),a=e.title;b.rc("loading"),i.ac(e.type+"page"),y.text(a),t(".m-loading",i).rc("loading has-new"),t("[href='"+n(e.path)+"']",i).ac("selected"),o.on("focus blur",function(e){o.closest(".m-subnavi").tc("focus","f"==e.type[0])}),"search"==e.type?(y.parent().show(),e.length?(e.old_query&&y.html(s.showing+" &ldquo;<strong>"+a+"</strong>&rdquo;"+"<em>"+s.noresults+" &ldquo;"+e.old_query+"&rdquo;"),e.suggestion&&y.html("<strong>"+a+"</strong>"+"<em>"+s.mean+" <a href='#!/?"+e.suggestion+"'>"+e.suggestion+"</a>?")):y.html(s.noresults+" &ldquo;<strong>"+a+"</strong>&rdquo;"),o.val()!=y&&o.val(a).keyup()):o.val(""),e.size||"spam"!=e.type||y.append("<em>"+s.nospam+"</em>")}),r.on("newcount",function(e){function o(e,o){t(".m-newcount",e).toggle(o>0).text(o)}o(u,e.feed),o(v,e.all),e.all||t(".m-has-new",d).rc("has-new")}),t("#m-search",l).each(function(){var o=t(this),n=t(":input",o).placeholder2("m-");n.keyup(function(o){if(13==o.which){var n=t.trim(this.value);n&&e.search(n)}}),t(".m-placeholder",o).click(function(){n.focus()})}),history.pushState&&(e.on("load",function(e){var t=e.path,o=n(t),a=location.hash.split("::")[0];e.is_init||"/"!=t[0]||o==a||history.pushState(null,null,o)}),t(window).on("popstate",function(){var t=unescape(location.hash.split("#!/")[1]||"");(t||e.page.path!=e.path)&&(e.page.is_init||e.load(t))}))}});var et=[9,16,27,33,34,35,36,37,38,45,91],tt=/(iPad|iPhone|iPod)/g.test(navigator.userAgent),ot=80;moot(function(e){function o(){return u.is(":visible")&&!u.data("value")?(u.click(),p.prop("disabled",!0),u.one("select",function(){p.prop("disabled",!1)}),!1):!0}var n=t(".m-create",e.root),a=t("textarea",n),i=a.eq(0).autogrow(),r=a.eq(1).autogrow(30),s=moot.language,l=window.getSelection,c=e.user.is_logged,d=e.conf();if(d.sso&&!c)return d.login_url?n.html(t("<a/>",{html:s.login_and+" "+s.start.toLowerCase(),href:d.login_url}).ac("sso-link")):n.remove();a.on("focus away drag",function(e){var t="f"==e.type[0],o=!!i.val();o||(i.attr("placeholder",s[t?"title":"start"]),r.attr("placeholder",t?s.body:"")),n.tc("focused",t||o||!!r.val())}).trigger("away"),_(n,e),i.keydown(function(e){if(!(""+(l&&l()))){var o=e.which;if(tt)return 13==o?!1:0;if(!e.metaKey&&!e.ctrlKey||(86==e.which&&setTimeout(function(){var e=t.trim(i.val()).split("\n"),o=e[0];o.length>ot&&(e[1]=o.slice(ot)+e[1],o=o.slice(0,ot)),i.val(o).keyup().keydown(),r.val(e.slice(1).join("\n")).keyup().keydown()
},50),-1==t.inArray(o,et))){var n=this.value.length;return 13==o||8!=o&&39!=o&&n>=ot||n==this.selectionStart&&39==o||40==o?(r.focus(),!1):void 0}}}),r.keydown(function(e){if(!(""+(l&&l()))){var t=e.which,o=this.selectionStart,n=this.value.substr(0,o).split("\n").length;return 1==n&&38==t||(37==t||8==t)&&!o?(i.focus(),!1):void 0}}).focus(function(){i.val()||i[0].focus()});var u=t(".m-select",n);e.on("categories",!0,function(){var o=t("ul",u).empty();t.each(e.categories||[],function(e,n){o.append(t("<li/>",{"data-value":n.path,text:n.title}))}),u.sel2({prefix:"m-"})}).on("before:load",function(e){t("li[data-value='"+e.path+"']",u).click()});var p=t("button",n).text(c?s.post:s.login_and+" "+s.post.toLowerCase());p.click(o),p.click(function(l){if(l.preventDefault(),c&&o()){var d=t.trim(r.val()),m={path:u.data("value"),title:i.val(),body:d},f=z(d);if(f[0]&&(m.files=f),e.is_forum&&"page"==e.page.type&&m.path!=e.page.path)return e.load(m.path,function(){p.click()});a.val("").trigger("away").blur(),e.create(m).fail(function(o){t(".m-created",e.root).remove(),i.val(m.title).focus(),r.val(d.join("")),n.prepend(t("<div/>").ac("err tooltip").text(s.error)),m.error=o,e.log("error create:failed",m)})}})});var nt=[16,27,33,34,35,36,37,38,39,40,45,91],at={};moot(function(e){e.channel.on("reconnect close",function(){t(".m-form",e.root).each(function(){var e=t(this),o=t("textarea",e),n=e.closest(".m-moot").data("moot");at[n?n.path:"@"]=n?o.val():{title:o.eq(0).val(),body:o.eq(1).val()}})}),e.one("load",function(o){t.each(at,function(n,a){var i=o.find(n);a&&(i?t("textarea",i.root).val(a).focus():"@"==n&&(t(".m-input-body",e.root).val(a.body),t(".m-input-title",e.root).val(a.title).focus()))}),at={}})}),moot("topic",function(e){var o=t(".m-form",e.root),n=t("textarea",o).autogrow(30),a=t("button",o),i=moot.language,r=e.app,s=r.conf(),l=r.is_commenting?i.post:i.replybtn,c=r.user.is_logged;return c||(l=i.login_and+" "+l.toLowerCase()),s.sso&&!c?(o.html("<div class='m-writing'/>"),s.login_url?o.append(t("<a/>",{href:s.login_url+"#!"+escape(e.path),html:l+"&hellip;"}).ac("sso-link")):0):(a.text(l),_(o,r),n.on("focus away",function(e){o.tc("focused","f"==e.type[0]||!!n.val())}),e.seed.is_stub&&(n.attr("placeholder",e.replies.length?i.comment:i.comment1),e.one("reply",function(){n.attr("placeholder",i.comment)})),a.click(function(a){a.preventDefault();var s=t.trim(n.val()),l={body:s},d=z(s);s&&c&&(n.val("").trigger("away").trigger("keydown").blur(),d[0]&&(l.files=d),e.reply(l).fail(function(a){t(".m-created",e.root).remove(),n.val(s).focus(),o.prepend(t("<div/>").ac("err tooltip").text(i.error)),r.log("error reply:failed",{moot:e.path,body:s,error:a})}))}),void 0)});var it={},rt="FormData"in window&&"File"in window;moot("load",function(){it={}}),moot(function(e){function o(i,r){if("undefined"==typeof _gat){if(n)return;return n=!0,t.getScript("//google-analytics.com/ga.js",function(){o(i,r)})}var s=_gat._createTracker(a);s._trackEvent("Moot: "+i,r,e.user.path||"anonymous")}var n,a=e.analytics&&e.analytics.ga;a&&(e.channel.on("login join",function(){setTimeout(function(){o("login",e.page.path)},10)}),e.on("before:load",function(e){e.one("load",function(){o("load",e.title),"moot"==e.type&&o("topic",e.title)}),e.on("before:moot",function(e){o("post",e.seed.title)}).on("moot",function(e){e.on("load before:reply like",function(t){"load"==t&&(t="topic"),"before:reply"==t&&(t="post"),o(t,e.seed.title)})})}))});var st;moot(function(e){function o(e,t){document.title=e.displayname+" "+t,setTimeout(function(){document.title=st},a)}st||(st=document.title||t("title").text()||"");var n=e.is_forum,a=(e.user,1e3*Z);e.channel.on("moot reply",function(e,t){t.seed&&(t=t.seed),t.path&&o(t.user," – "+(t.title||t.body[0]).slice(0,32))}).on("type",function(e){o(e,moot.language.writing)}),n&&e.on("load",function(e){e.title&&(document.title=e.title+" | "+st)})});var lt=".m-image, .m-youtube-link, .m-youtu-link, .m-vimeo-link";moot(function(e){var o;t(".m-page",e.root).on("click",lt,function(e){var n=t(e.target);if(!n.hc("vimeo-link")||parseInt(n.attr("href").split("/")[3])){e.preventDefault();var a=t("#m-gallery");a[0]||(a=t(m("gallery")).appendTo("body")),o||(o=a.active2("m-"));var i=t("#m-navi",a).empty(),r=t("#m-media"),s=t("iframe",r),l=t("img",r),c=t(lt,n.closest(".m-body"));n.closest(".m-moot"),c=c.filter(function(){var e,o,n=t(this),a=t("<span/>").appendTo(i).html("<em>"+n.text()+"</em>"),c=n.attr("href");if(/youtu/.test(n.attr("class"))){o=(c.split("?v=")[1]||c.split("/").slice(-1)[0]).split(/[&#]/)[0],e="//www.youtube.com/embed/"+o+"?autoplay=1";var d=/[#&]t=([^&$]+)/.exec(c);d&&(e+="&start="+d[1]),c="//i1.ytimg.com/vi/"+o+"/mqdefault.jpg"}else if(n.hc("vimeo-link")){if(o=c.split("/").slice(-1)[0],!parseInt(o))return!1;e="//player.vimeo.com/video/"+o+"?autoplay=1",t.getJSON("//vimeo.com/api/v2/video/"+o+".json?callback=?",function(e){c=e[0].thumbnail_small,a.css("backgroundImage","url("+c+")").attr("src",c)}),c=""}return it[c]&&(c=it[c].data),a.css("backgroundImage","url("+c+")").click(function(){var o=t(this);t("span",i).rc("active"),o.ac("active"),s.attr("src",""),r.tc("is-video",!!e),e?(s[0]||(s=t("<iframe/>",{webkitAllowFullScreen:!0,mozallowfullscreen:!0,allowFullScreen:!0,frameborder:0,height:390,width:640}).appendTo(r)),s.attr("src",e)):l.attr("src",c)}),e&&a.ac("video"),!0}),i.toggle(c.length>1),a.on("open",function(){var e=t(window).scrollTop(),o=t(document);a.css({width:o.outerWidth(),height:o.outerHeight(),paddingTop:e}),r.css({height:screen.availHeight-i.filter(":visible").height()-120})}).on("close",function(){s.attr("src",""),l.attr("src","data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==")}),a.on("click",function(e){(e.target==a[0]||e.target==r[0])&&a.trigger("close")}),t("span",i).eq(c.index(n)).click(),a.trigger("open")}})}),moot(function(e){var r,s,l=e.root,c=t(m("growl")).appendTo(l),d=c.eq(0),u=c.eq(1),p=t(".m-entries",c);t(".m-destroy",c).click(function(){p.empty(),c.hide(),r=!0}),u.click(function(){c.show(),u.hide(),r=!1}),e.channel.on("moot reply",function(c,f){if(f){f.seed&&(f=f.seed);var g=e.page,h=g.find(f.path);if(!h||"moot"!=g.type&&!t(".m-focus",h.moot.root||1)[0]){t(".m-logo",l).remove();var v=f.title||f.body&&f.body[0];v=v.replace(Y,function(e){return e.split("/").slice(-1)}).replace(G,function(e,t){return t}),v.length>=90&&(v=v.slice(0,90).slice(0,v.lastIndexOf(" "))+"&hellip;"),v=o(i(n(v)));var b={time:+new Date,user:f.user||f,title:v,path:f.path};b.user.displayname=a(b.user.displayname);var w=t(m("event",b)).prependTo(p);t(".m-link",w).click(function(){function t(){n.root.click(),setTimeout(function(){y(n.find(f.key).root)},500)}var o=g.find(f.path),n=o?o.seed?o:o.moot:g.find(f.moot.path);n?n.is_loaded?n.is_expanded?n.is_expanded&&y(o.root):t():n.load(t):g.path==f.moot.page.path?g.lift(f.moot.path,function(){f=g.find(f.path),f&&y(f.root)}):e.is_forum&&e.load(f.moot.path,function(){f=g.find(f.path),f&&y(f.root)})}),r?u.show().mootboost(200):(u.hide(),d.show().mootboost(200),clearInterval(s),s=setTimeout(function(){d.hide(),u.show()},1e3*Z),d.one("mouseenter",function(){clearInterval(s)})),t(".m-entry",d).length>3&&d.ac("large")}}}).on("remove",function(e){t("[data-path='"+e.path+"']",d).remove(),t(".m-event",p)[0]||c.hide()})}),moot(function(e){function o(o){t("a.m-facelink",o).each(function(){var o=t(this).data("href")||t(this).attr("href");t(this).tc("online",!!e.users.find(o.slice(3)))})}if(e.users){e.on("before:load",function(e){e.on("moot",function(e){e.on("load more reply",!0,function(n,a){var i=a&&a.root||e.root;o(i),t(".m-like_count",i).on("open",function(){setTimeout(function(){o(t(".m-like_list",i))},500)})})})}),e.channel.on("enter leave",function(o,n){n&&t("a.m-facelink[href$='"+n.path+"']",e.root).tc("online","enter"==o)});var n=e.root,a=t(".m-nav-online",n),i=t(".m-users",n),r=moot.language;if(e.conf().show_online===!1)return a.remove();i[0]||(i=t(m("online")).appendTo(t(".m-sidebar",n))),i.active2({prefix:"m-",trigger:a},function(e,t){var o=t.offset();e.offset({top:o.top+t.outerHeight()+10,left:o.left-i.outerWidth()+t.outerWidth()-10})}),i.each(function(){function o(e){return t("[href*='"+e.path+"']",s)}function n(e){var n=o(e);return n[0]||(n=t(m("face",{user:e})).tooltip2({prefix:"m-"}).appendTo(s),e.is_admin&&(n.ac("is-admin"),t(".m-tooltip",n).append("<em> ("+r.admin+")</em>")),t("img",n).removeAttr("title")),n}var a=t(this),s=t(".m-logged-users",a),l=t(".m-users-title em",a).add(t(".m-nav-online em",e.root)),c=t(".m-anon-count",a),d=e.users&&e.users.online;return d?(s.on("click","a",function(){i.trigger("close")}),e.channel.on("enter",function(e){e&&n(e).mootboost(500)}).on("leave",function(e){e&&o(e).fadeOut(function(){t(this).remove()})}).on("away return",function(e,t){o(t).tc("inactive","away"==e)}).on("type",function(e){var n=t("<em/>").ac("typing").appendTo(e.path?o(e):c);setTimeout(function(){n.remove()},1e3*Z)}).on("enter leave away return",!0,function(){var t=d.length,o=e.users.anon_count;l.text(t).add(s).toggle(t>0),c.toggle(o>0).html((t>0?"+":"")+"<em>"+o+"</em> "+r[1==o?"anon_1":"anon"])}),t.each(d,function(e,t){n(t)}),void 0):a.hide()})}}),moot(function(e){function o(e,o,n){if(a.test(e)){var i;return t(".m-facelink[href$='"+e+"']",n).each(function(){return i=t(".m-body p:contains('"+o+"'):first",t(this).next()),i[0]?!1:void 0}),i}}var n,a=/^@[a-z0-9\-]{5,}$/i;t(document).mousedown(function(e){n&&e.target!=n[0]&&n.hide()}).mouseup(function(e){setTimeout(function(){var o=t(e.target),a=window.getSelection,i=a?""+a():document.selection.createRange().text;a&&(a=a(),t(a.anchorNode).closest("p")[0]!=t(a.focusNode).closest("p")[0]&&(i="")),t.trim(i)&&!o.hc("name")&&o.closest(".m-post")[0]&&(n=t("#m-quote"),n[0]||(n=t("<a/>",{id:"m-quote",text:'"'}).data("skip-hover",!0).appendTo("body")),n.show().css({top:e.pageY-17,left:e.pageX+5}),n.unbind("click").click(function(){var e=t("textarea",o.closest(".m-moot")),a=o.closest(".m-post").prev().attr("href").slice(3),r=e.val();r&&(r+="\n"),r+="> "+a+"\n",r+="> "+i+"\n",y(e,10,function(){e.val(r).trigger("keyup").trigger("keydown");var t=e[0];t.focus(),t.selectionStart=t.selectionEnd=t.value.length}),n.hide()}))},1)}),e.on("format",function(e,n){t("blockquote",e).each(function(){var e=t(this),a=t("p:first",e),i=a.text(),r=t("p:gt(0)",e).text(),s=n.moot?n.moot.root:e.closest(".m-moot"),l=o(i,r,s);l&&(a.ac("user-path"),e.ac("quote").on("mouseenter mouseleave click",function(e){"click"==e.type?y(l):t("body").is(":animated")||l.tc("boosted",/ee/.test(e.type))}))})})});var ct=/font-family:\s?['"]?([\w\s]+)['"]?;/,dt=t("<span/>",{text:"My F0n# T000 Str--ing"});moot.css={accent:".m-heart.m-has-likes span, .moot .m-button::after, .moot .m-show-help",accentbg:".moot button, .m-button",body:".moot .m-body, .m-input-body",boxes:".m-moot, .m-sidebar",button:".moot .m-button, .moot button",collapsed:".m-moot.m-collapsed .m-title",create:".moot .m-input-wrap",face:".m-face",header:".moot .m-header",headings:".moot .m-sidebar .m-h3, .m-pagetitle, .m-navi a",input:".m-focused .m-input-wrap, .m-focused.m-replyform textarea",moot:".moot",navi:".m-links",page:"body",para:".m-body p, .moot textarea",replies:".moot .m-replies",reply:".m-reply",selected:".m-navi a.m-selected, .m-pagepage .m-nav-forums, .m-userpage .m-nav-online",sidebar:".m-sidebar",title:".moot .m-title, .moot textarea.m-input-title",topic:".moot .m-moot, .m-create .m-input-wrap, .m-preview",wrap:".m-wrap, .m-tablet"};var ut={};moot.loadFont=function(e,o){if(ut[e]||A(e))return o&&o();ut[e]=!0,e=j(e.replace(/ /g,"+"));var n='<link href="//fonts.googleapis.com/css?family='+e+"\" rel='stylesheet'>";t(n).appendTo("head").load(o)},moot(function(e){function o(){var e=(d[0]||n[0]).clientWidth/c;n.tc("pc",e>=43).tc("tablet",43>e).tc("mobile",25>e)}var n=e.root,a=e.user.is_logged,i=e.design,r=t(window),s=r.outerHeight(),l="";n.rc("app-loading loading").tc("sso",!!e.conf().sso).tc("logged",a).tc("no-logged",!a).tc("ie8",!!t.browser.msie&&9>t.browser.version).tc("webkit",!!t.browser.webkit||!!t.browser.chrome),i&&(n.addClass(i.classes),t.each(i.css,function(e,t){if("page"!=e||/moot.it/.test(location.host)){l+=moot.css[e]+"{"+t+"}";var o=ct.exec(t);o&&moot.loadFont(o[1])}}),t("head").append(t("<style/>",{id:"moot-css",text:l})));var c=parseFloat(n.css("fontSize")),d=t(".m-wrap:eq(1)",n);r.resize(o),o(),r.one("load",o);var u=t(".m-logo",n);window!=window.top&&n.hc("mobile")?u.remove():(t("a",u).tooltip2({prefix:"m-",position:"left"}),(400>s||n.offset().top>s)&&u.ac("below-fold"),e.is_commenting&&(t(".m-create",n).remove(),n.on("click","a[href^='#!']",function(e){e.preventDefault()})))}),moot(function(e){var o=/.+@.+\..+/i,n=/^[^\<\>]{5,}$/,i=e.root,r=e.user,s=e.conf(),l=moot.language,c=t(".m-nav-account",i),d=t(m("account_overlay")).prependTo(i),u=t(".m-h2",d).text(r.displayname),p=t(".m-me",c),f=!!e.conf().sso;if(!e.user.is_logged)return f&&t(".m-login",i).remove(),void 0;t(".m-myname",c).text(e.user.displayname),d.active2({prefix:"m-",trigger:p},function(){var e=p.offset();d.offset({left:e.left+(s.rtl?0:p.outerWidth()-d.outerWidth()),top:e.top+p.outerHeight()+10})}),t(".m-names strong",d).text(r.path),t.each(["displayname","email"],function(){t("[name='"+this+"']",d).val(r[this])}),t(".m-logout",d).click(function(){i.ac("loading"),r.logout()}),t(".m-status",d).each(function(){function e(){var e=r.is_visible;t("em",o).text(l[e?"online":"invisible"]),t("a",o).text(l[e?"hide":"show"]),o.tc("invisible",!e)}var o=t(this);t("a",o).click(function(){o.ac("loading"),r.hideToggle(function(){o.rc("loading"),e()})}),e()}),t(".m-unfollow",d).each(function(){var e=t(this);r.on("follow unfollow",!0,function(){var o=r.subscription_count;e.toggle(o>0),t("em",e).text(o)}),t("a",e).click(function(){e.fadeOut(400),r.unfollowAll()})});var g=t(".m-face",d).attr("src",r.img),v=t(".m-preview img, img[title='"+r.displayname+"']",i).add(g),b=t(".m-upload",d);if(t(".m-me",c).one("click",function(){b.jsonrpc({api:"https://api.moot.it",method:"userUpdate",session:e.channel.session}).on("done",function(e,t){v.attr("src",t).rc("loading"),r.emit("update",{img:t})}),b.tooltip2({prefix:"m-"})}),t(":file",b).bind("change drop",function(e){t.each(e.target.files||[],function(e,t){if(t.type.match("image.*")&&15e5>t.size){var o=new FileReader;o.onload=function(e){v.attr("src",e.target.result)},o.readAsDataURL(t)}}),"change"==e.type&&t("button",b).click()}).bind("dragenter dragleave change",function(e){t(this).tc("hover",/enter/.test(e.type))}),t("form:gt(0)",d).each(function(){function e(){var e=t.trim(d.val()),a="email"==m?o:n;return e!=r[m]&&a.test(e)}var c=t(this),d=t("input",c),p=t("<button/>",{text:l.change,disabled:!0}).appendTo(c),m=d.attr("name");d.keyup(function(){var t=e();p.show().prop("disabled",!t),this.value==r[m]&&p.hide(),t&&c.rc("is-error")}),c.submit(function(o){if(!e())return!1;o.preventDefault(),c.ac("loading").rc("valid");var n={},p="email"==m,f=a(t.trim(d.val()));n[m]=f,p&&(n.url=s.pageUrl),r.update(n,function(){if(c.rc("loading").ac("updated"),!p){var e=t("<span class='m-saved'>"+l.saved+"</span>").appendTo(c);setTimeout(function(){e.remove()},1e3),u.add(".m-nav-account .m-name",i).text(f)}}).fail(function(e){c.rc("loading").ac("is-error"),t(".m-error",c).text(/taken/.test(e)?l[m+"_taken"]:l.invalid)})})}),t(".m-maillist input").prop("checked",!!r.maillist).change(function(){var e=t(this);r.update({maillist:!!this.checked},function(){e.parent().mootboost()})}),t(".m-password a",d).click(function(){var o=t.extend({host:s.url.host,l:l.$code,rtl:s.rtl},e.channel.session);e.brand_logo&&(o.logo=e.brand_logo),e.brand_color&&(o.bgcolor=e.brand_color),h("https://moot.it/auth/1.8.1/password.html?"+t.param(o),300,335)}),r.unverified){i.ac("is-unverified"),t(".m-page",i).prepend(m("unverified")).find(".m-unverified a").click(function(){t(".m-nav-account a").click()});var y=t("<p/>").ac("incomplete").html(l.unver3);t(".m-email .m-h3",d).append(t("<span/>").ac("badge").text(l.unver)).after(y),t("a",y).click(function(){r.sendValidationCode({forumname:e.name,url:s.pageUrl},function(){y.text(l.unver4)})})}f&&t(".m-h3, form, .m-password, .m-maillist",d).remove()}),moot(function(e){function o(){function o(o,n){return/invalid/.test(n)?(g.empty(),d.append(f),p.url=e.conf().pageUrl,delete p.path,"sendValidationCode"==o&&(p=p.url),u[o](p,function(){g.html(m("expired"))}).fail(function(e){g.html(m("confirm_error")),t(".m-h2",g).text(t.isArray(e)?e[0]:e)})):void 0}var i=(unescape(location.hash).split("!")[1]||"").split("/"),r=moot.language,s=i[0],l=i[1],c=i[2];if(!n&&/password|account|email/.test(s)&&a.test(c)&&l){n=!0;var d=e.root,u=e.user,p={confcode:l,email:c},f=t("<div class='m-mask'><div class='m-panel'/></div>"),g=t(".m-panel",f).append(m("confirm_"+s)),v=t(".m-h3",g);if(u.is_logged||(p.path=e.page.path),v.text()||v.text(c),f.on("click","button",function(){f.remove(),"localhost"!=location.hostname&&history.replaceState&&history.replaceState(null,null,"#")}),t(document).one("keydown",function(e){27==e.which&&f.remove()}),"password"==s)return u.is_logged?!0:u.checkResetCode(p,function(){p.id=p.email,delete p.email,d.append(f),t("button",f).click(function(){t.extend(p,{host:e.conf().url.host,l:r.$code,rtl:e.conf().rtl},e.channel.session),e.brand_logo&&(p.logo=e.brand_logo),e.brand_color&&(p.bgcolor=e.brand_color),h("https://moot.it/auth/1.8.1/forgot.html?"+t.param(p),300,270)})}).fail(function(e){p.id=p.email,delete p.email,o("resetPassword",e)});if("account"==s||u.is_logged){var b="account"==s;u[b?"confirmAccount":"confirmEmail"](p,function(){d.append(f),b?(d.rc("is-unverified"),t(".m-unverified",d).remove()):t(".m-email input",d).val(c)}).fail(function(e){o(b?"sendValidationCode":"update",e)})}else d.append(f),t(".m-h2",f).text(r.login1),t("button",f).click(function(){t(".m-login",d).click()});t(window).off("popstate.confirm")}}var n,a=/.+@.+\..+/i;t(window).on("popstate.confirm",o),setTimeout(o,t.browser.msie?500:0)}),moot(function(e){function o(){var o;n.like&&(o=e.page.like(n.path)),n.reply?(delete n.reply,e.page.reply(n,function(e){y(e.root)})):n.create&&(delete n.create,e.create(n),o=t(".m-moot:first",e.root)),o&&o.root&&y(o.root)}var n,a=/^[a-z0-9\-]{5,}$/i,i=window.localStorage||{},r=e.conf(),s=moot.language,c=e.user,d=e.root,u=t();r.sso||(d.on("click",".m-form button, .m-login, .m-like",function(o,a){if(!e.user.is_logged){var l=t(this),c=l.closest(".m-form"),d=t("textarea",c),u=l.closest(".m-moot").data("moot"),p={referrer:i["moot.referrer"],host:r.url.host,url:r.pageUrl,path:e.page.path,l:s.$code,rtl:r.rtl};e.brand_logo&&(p.logo=e.brand_logo),e.brand_color&&(p.bgcolor=e.brand_color),a&&t.extend(p,a),n={body:d.last().val()};var m=z(n.body);m[0]&&(n.files=m),l.is(".m-like")?(n.like=!0,n.path=(l.closest(".m-post").data("post")||l.closest(".m-moot").data("moot")).path):u?(n.reply=!0,n.path=u.path):c.length&&(n.create=!0,n.title=d.first().val(),n.path=t(".m-select",c).data("value")),(window.mootlogin||h)("https://moot.it/auth/1.8.1/?"+t.param(t.extend(p,e.channel.session)),360,400)}}),e.channel.on("login",function(n){e.reload(n),o(),n.user.join&&(u=t(m("join")).appendTo(d),t("button",u).click(function(){u.remove()}))}).on("join",function(n){function i(){p.prop("disabled",!h.is(":checked")||!g.parent().hc("ok"))}u.trigger("close");var r=t(m("social_join")).appendTo(d),p=t("button",r),f=n.user;t(".m-face",r).attr("src",f.img),t(".m-h2 span",r).text((f.name||f.displayname).split(" ")[0]),t(".m-terms a").attr({href:"https://moot.it/terms",target:"_new"});var g=t(":text",r).val(f.username).keyup(function(){var e=a.test(this.value),o=this.value.length;t(this).parent().tc("ok",e).tc("fail",o>3&&!e),i(),o>2&&g.next().text(s[e?"uname_len":"username_fail"])}),h=t(":checkbox",r).change(i);g.triggerHandler("keyup"),t("form",r).submit(function(){var a={secret:n.secret,username:g.val(),provider:n.provider,path:e.page.path};return c.join(a,function(){d.rc("is-join"),o()}).fail(function(e){if(/taken/.test(e)){var o=g.parent().ac("is-error").rc("ok");t(".m-error",o).length||t("<p/>").ac("error").text(l.uname_taken).insertAfter(g)}}),!1})}))}),t(function(){t(".moot[href]").moot(),t(".moot .moot-url[href]").each(function(){var e=t(this);e.closest(".moot").moot(e.remove().attr("href"))})}),t.fn.moot=function(e,o){return e=e||{},"string"==typeof e&&(e={url:e}),this.each(function(){var n,a=t(this),i=a.attr("href"),r=location.hash.split("#!")[1],s=a.data().pagetitle||document.title||t("title").text()||"",l=moot.language,c=t("<div class='m-loading-text'>"+l.loading+"</div>");if(i||(i=t(".moot-url",a).remove().attr("href")),t("*",a)[0]&&!t(".m-page",a)[0]&&(n=a.html()),t.extend(e,a.data(),{mootTitle:a.attr("title"),pageTitle:s.slice(0,30*Z)||"Untitled",url:(i||e.url).toLowerCase(),pageUrl:location.href.split("#")[0],rtl:"rtl"==t("html").attr("dir")}),r&&"/"==r[0]&&(e.path=unescape(r)),a.is("a")){var d=t("<div/>").attr({"class":a.attr("class"),"data-url":e.url});a.replaceWith(d),a=d}a.addClass("moot m-app-loading"),t("*",a)[0]||a.empty(),a.prepend(c);try{moot("error",function(e){"currentforum:invalid"==e&&a.html(l.badforum+': "'+this.name+'"')}),moot(e,function(e){e.html=n,e.root=a,t.isFunction(o)&&o.call(e,e),c.remove()})}catch(u){a.rc("app-loading"),/json-rpc/.test(u.message)&&a.ac("no-support").html(m("browser")).append('<img style="display:none" src="//oldbrowser.moot.it/'+escape(navigator.userAgent)+'">')}})}}(!this.top,jQuery),function(e){"use strict";function t(e,t){for(var o in t)e[o]=t[o];return e}function o(e,o){return t(t({},e),o)}function n(t,n,i){if(t=t.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/&lt;mark&gt;/g,"<mark>").replace(/&lt;\/mark&gt;/g,"</mark>"),!n)for(var r in a){var s=a[r].detect;if(s&&s.test(t)){n=r;break}}var l="",c=[],d=o(a.common,a[n]);for(var r in d){var u=d[r],p=r.split(",");u&&"detect"!=r&&t.replace(u,function(){for(var e,t,o,n,a=0,i=p.length,r=arguments;i>a;a++)e=p[a],t=i>1?1:0,o=r[a+t],n=r[i+t],4!=r.length||t||(o=r[1]||r[0],n=r[2]),a&&(n+=[].slice.call(r,1,a+1).join("").length),c.push([n,n+o.length,e])})}c=c.sort(function(e,t){return e[0]-t[0]});for(var m,f,g,h=0,v=0,b=0,y=c.length;y>v;v++)m=c[v],f=c[v-1]||[],g=c[v+1]||[],b>m[0]||m[0]==g[0]&&g[1]>m[1]||m[1]>b&&(b=m[1],l+=t.substring(h,m[0]),l+='<span class="'+(i||"")+m[2]+'">'+t.substring(m[0],m[1])+"</span>",h=m[1]);return l+=t.substring(h),e?l:"<pre class='"+i+"syntax "+i+(n||"common")+"'>"+l+"</pre>"}var a={common:{comment:/\/\*[^\*]*\*\/|\/\/.*$|\#\s.*\n/gm,string:/'[^']*'|"[^"]*"/g,keyword:/\b(none|true|false|and|array|catch|class|def|delete|echo|end|else|elseif|exit|extends|except|finally|for|foreach|global|if|import|local|module|new|object|or|package|print|private|protected|public|rescue|return|require|self|struct|static|sub|switch|then|this|throw|try|unsigned|var|while)\b/gi,operator:/\+|\!|%|\-|&lt;|&gt;|&amp;|;|:|\||\*|\=/g,bracket:/[{}\[\]\(\)]/g,number:/\b\d+\.?\d*\b/gi,accent1:/\b(boolean|const|void|char|short|int|integer|long|float|double|string)\b/g,"accent2,bracket":/\b(\w+)\s?(\()/gi},html:{operator:0,accent1:0,accent2:0,comment:/(&lt;\!--[^;]*--&gt;)/g,"bracket,accent1":/(&lt;\/?)(\w+)/g,keyword:/doctype/i,"accent2,operator":/([\w-]+)(=)/g,bracket:/&lt;|&gt;/g,detect:/^\s*&lt;/},java:{accent3:/@\w+\b/gi},js:{accent1:/\$|window|document|setTimeout|setInterval|console/g,accent3:/\/.+\/[igm]{0,3}/g,detect:/var\s*\w+\s*=/},css:{keyword:/none|inline|inline-block|block|rgba?|hsla?|solid|dotted/gi,"number,accent1":/(\d+\.*\d*)(px|em|rem|%)/gi,string:/#[a-f0-9]{3,6}/gi,accent1:/\s?([\-\w,\. \s#]+){\s?/gi,accent2:/\b([\-\w]+):\s?/gi,accent3:/\b(before|after|active|hover|focus)\b/gi},python:{accent3:/"""[\w\W]*"""/gm},ruby:{accent1:/\b(String|ArgumentError|puts|Thread|Errno::|Exception)\b/g,accent3:/[@:]\w+/g},markdown:{keyword:/[\*_].+[\*_]/gi,accent1:/#{1,2} .+/g,accent2:/#{3,} .+/g,accent3:/[- =]{3,}/g},sh:{accent1:/\b(echo|rm|ls|mkdir|rmdir|cd|find|cp|exit|pwd|exec|set|sed|awk)\b/g},php:{accent3:/\$\w+\b/g},perl:{"keyword,accent3":/\b(sub)\s*(\w+)\s*{/g},lua:{comment:/--.*\n/g},sql:{accent1:/\b(insert|into|create|table|update|select|from|where|values)\b/gi},redis:{accent1:/[A-Z]+/g}};a.javascript=a.js,a.stylus=a.css,a.yaml=a.markdown,a.shell=a.bash=a.sh,a.coffee=a.coffeescript=o(a.python,{accent1:a.js.accent1,accent2:/-&gt;/g,detect:/-&gt;/g}),a.django=a.jinja=o(a.html,{bracket:a.common.bracket,keyword:/\b(set|block|endblock|extends|if|endif)\b/g,accent3:/(\{\{.+\}\})/g}),a.markdown.comment=a.html.comment,a.css.detect=a.css.number,a.sql.comment=a.lua.comment,n.lang=a,e?module.exports=n:window.hilite2=n,"function"==typeof jQuery&&(jQuery.fn.hilite2=function(e){return this.each(function(){var t=jQuery(this);t.replaceWith(n(t.html(),t.attr("class"),e))})})}("object"==typeof exports);moot.language={$code:"en",banned:"Banned account",banned2:"You are temporarily banned from posting on this forum for violating forum policies. Time left:",banned4:"You can no longer post on this forum.",warning:"Warning",profanity:"Profanity is not allowed on this forum. Continued abuse of this policy will result in being banned.",max:"Maximum image size is 4Mb",yes:"Yes",upload:"Upload images",show:"show",hide:"hide",invisible:"Invisible",givebody:"Body cannot be empty.",show_old:"Show oldest replies",show_more:"Show more replies",show_new:"Show newest replies",start:"Start a new topic...",error:"Oops, an error. Please copy the post to clipboard, reload and try again. Sorry – we will fix this!",body:"Body text",admin:"Admin",someone:"Someone",title:"Title",writing:"is writing...",basic:"Basic (free)",subs:"Subscriptions",manage:"Manage",fullview:"Full view",link:"link",avatar:"Change avatar",seo_update:"The SEO pages will be updated within the hour",upgrade_link:"Upgrade",branding:"Branding",logo:"Logo",bgcolor:"Background color",brand_name:"Brand name",title:"Title",css:"CSS file",mootbrand:"Use Moot branding",sso:"Single Sign-On",apikey:"API key",apisecret:"Secret key",single:"single word",username_fail:"Use letters, numbers or dashes",bold:"bold",italics:"italics",monospaced:"monospaced",domain:"Forum URL",domaintip:"Full URL to the forums where users are pushed from the search results",learn:"Learn more...",ga:"Google Analytics Id",admins:"Administrators",adminstip:"One username per line",settings:"Settings",all:"All posts",anon_1:"anonymous",anon:"anonymous",badforum:"Invalid forum",c_acc1:"Your account now works on all sites using Moot",c_acc:"Account confirmed",c_email:"Email address updated",cancel:"Cancel",change:"Change",changepw:"Change password",close:"Close",collapse:"Collapse all",comm_count_1:"comment",comm_count_n:"comments",comment1:"Be the first to comment...",comment:"Comment...",edit:"edit",email:"Email",email_taken:"This email is taken",emailtip:"Your email is never shared",enter:"ctrl + enter",expired1:"We just sent you a new one. Please check your email.",expired:"This link has expired",feed:"My feed",forumname:"Forum name",forums:"Forums",help2:"post",help3:"quoted",help5:"code, language guessed",help6:"HTML code",in_forum:"in",invalid:"Invalid value",join:"Join Moot",later:"Later...",less:"less",like:"Like",likepost:"Like this post",loading:"Loading...",login:"Log in",login1:"Log in first",login_and:"Login and",logout:"Log out",mark:"Offensive or spam",mean:"Did you mean",name:"Display name",nametip:"Your real name, so people will recognize you",newcat:"New category",newpass:"New password",noresults:"No results for",nospam:"No spam on your forum!",notexist:"does not exist.",notify:"Notify me of new releases",ok:"ok",online:"Online",post:"Post",preview:"Preview",progress:["loading...","still working...","and working...","giving up"],reconnect:"Reconnecting...",removecat:"Remove. The posts are not removed",removepost:"Remove",reply:"Reply...",replybtn:"Reply",save:"Save changes",saved:"saved",search:"Search",select:"Select forum",setup:"Setup now",showing:"Showing",slogan:"Forums and commenting re-imagined",spam:"Spam",step1:"We have sent you a confirmation email. Your email is not updated before you complete this step!",step:"One more step",terms:"I agree to the <a>terms of service</a>.",thanks:"Thanks!",uname_len:"Type 6 characters or more",uname_taken:"This username is taken!",unametip:"This cannot be changed later",undo:"Undo",unlike:"Unlike",unspam:"Not spam",unver1:"Unverified account",unver2:"Please check your email to verify your account. Verified users can watch moots and receive email notifications. <a>Send a new verification code...</a>",unver3:"<a>Send a new</a> verification code to:",unver4:"Sent. Please check your inbox.",unver:"Unverified",unwall:"unwatch all",unwatch:"Unwatch",upgrade2:"Moot uses WebSockets or CORS for cross domain communication. All modern browsers above Opera 11 and IE7 work.",upgrade:"Please upgrade your browser",username_taken:"This username is taken",watch:"Watch for new replies",welcome1:"Please check your email to complete the registration. If you dont receive email within a minute or two, check your spam folder.",welcome2:"Please provide a Moot username",welcome:"Welcome to Moot",you:"You",now:"just now",months:"Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec",min:"m",hour:"h",day:"d",week:"w"};